{"version":3,"sources":["../src/battle-dex.ts"],"names":["window","global","exports","nodewebkit","process","versions","toID","text","id","userid","toLowerCase","replace","toUserid","PSUtils","splitFirst","str","delimiter","limit","splitStr","length","delimiterIndex","indexOf","push","slice","compare","a","b","localeCompare","Array","isArray","i","comparison","reverse","Error","sortBy","array","callback","sort","toRoomid","roomid","toName","name","trim","substr","Dex","gen","modid","cache","statNames","statNamesExceptHP","pokeballs","modResourcePrefix","resourcePrefix","prefix","document","location","protocol","fxPrefix","Replays","loadedSpriteData","xy","bw","moddedDexes","mod","BattleTeambuilderTable","ModdedDex","forGen","resolveAvatar","avatar","BattleAvatarNumbers","charAt","includes","Config","server","registered","port","host","encodeURIComponent","sanitizeName","prefs","prop","Storage","getShortName","shortName","getEffect","getItem","getAbility","getMove","PureEffect","nameOrMove","BattleAliases","BattleMovedex","data","exists","exec","hpWithType","hpPower","basePower","Number","move","Move","getGen3Category","type","nameOrItem","BattleItems","item","Item","nameOrAbility","BattleAbilities","ability","Ability","getSpecies","nameOrSpecies","formid","BattlePokedexAltForms","BattlePokedex","BattleBaseSpeciesChart","baseSpeciesId","startsWith","species","tier","baseSpecies","Species","cosmeticFormes","forme","baseForme","otherFormes","getTier","pokemon","genNum","table","overrideTier","getType","toUpperCase","BattleTypeChart","damageTaken","effectType","hasAbility","abilities","getSpriteMod","folder","overrideStandard","ModSprites","modName","loadSpriteData","path","$","attr","qs","split","match","el","createElement","src","getElementsByTagName","appendChild","getSpriteData","isFront","options","mechanicsGen","ModConfig","spriteGen","isDynamax","dynamax","Pokemon","volatiles","transform","shiny","gender","getSpeciesForme","spriteDir","fakeSprite","spriteid","endsWith","spriteData","w","h","y","url","pixelated","isFrontSprite","cryurl","dir","facing","graphicsGen","Math","max","min","baseDir","animationData","miscData","speciesid","isTotem","BattlePokemonSprites","BattlePokemonSpritesBW","num","baseSpeciesid","formeid","isMega","afd","noScale","allowAnim","getPokemonIconNum","isFemale","facingLeft","BattlePokemonIconIndexes","BattlePokemonIconIndexesLeft","getPokemonIcon","speciesForme","formechange","top","floor","left","fainted","getTeambuilderSpriteData","x","xydexExists","isNonstandard","getTeambuilderSprite","getItemIcon","spritenum","getTypeIcon","sanitizedType","getCategoryIcon","category","categoryID","sanitizedCategory","getPokeballs","Object","values","isPokeball","Moves","Items","Abilities","Types","parseInt","hasOwnProperty","overrideMoveInfo","key","fullItemName","overrideItemDesc","shortDesc","fullAbilityName","overrideAbilityDesc","overrideDexInfo","removeType","overrideTypeChart","require"],"mappings":"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","sourcesContent":["/**\n * Pokemon Showdown Dex\n *\n * Roughly equivalent to sim/dex.js in a Pokemon Showdown server, but\n * designed for use in browsers rather than in Node.\n *\n * This is a generic utility library for Pokemon Showdown code: any\n * code shared between the replay viewer and the client usually ends up\n * here.\n *\n * Licensing note: PS's client has complicated licensing:\n * - The client as a whole is AGPLv3\n * - The battle replay/animation engine (battle-*.ts) by itself is MIT\n *\n * Compiled into battledata.js which includes all dependencies\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license MIT\n */\n\ndeclare var require: any;\ndeclare var global: any;\n\nif (typeof window === 'undefined') {\n\t// Node\n\t(global as any).window = global;\n} else {\n\t// browser (possibly NW.js!)\n\twindow.exports = window;\n}\n\n// @ts-ignore\nwindow.nodewebkit = !!(typeof process !== 'undefined' && process.versions && process.versions['node-webkit']);\n\nfunction toID(text: any) {\n\tif (text?.id) {\n\t\ttext = text.id;\n\t} else if (text?.userid) {\n\t\ttext = text.userid;\n\t}\n\tif (typeof text !== 'string' && typeof text !== 'number') return '' as ID;\n\treturn ('' + text).toLowerCase().replace(/[^a-z0-9]+/g, '') as ID;\n}\n\nfunction toUserid(text: any) {\n\treturn toID(text);\n}\n\ntype Comparable = number | string | boolean | Comparable[] | {reverse: Comparable};\nconst PSUtils = new class {\n\t/**\n\t * Like string.split(delimiter), but only recognizes the first `limit`\n\t * delimiters (default 1).\n\t *\n\t * `\"1 2 3 4\".split(\" \", 2) => [\"1\", \"2\"]`\n\t *\n\t * `splitFirst(\"1 2 3 4\", \" \", 1) => [\"1\", \"2 3 4\"]`\n\t *\n\t * Returns an array of length exactly limit + 1.\n\t */\n\tsplitFirst(str: string, delimiter: string, limit: number = 1) {\n\t\tlet splitStr: string[] = [];\n\t\twhile (splitStr.length < limit) {\n\t\t\tlet delimiterIndex = str.indexOf(delimiter);\n\t\t\tif (delimiterIndex >= 0) {\n\t\t\t\tsplitStr.push(str.slice(0, delimiterIndex));\n\t\t\t\tstr = str.slice(delimiterIndex + delimiter.length);\n\t\t\t} else {\n\t\t\t\tsplitStr.push(str);\n\t\t\t\tstr = '';\n\t\t\t}\n\t\t}\n\t\tsplitStr.push(str);\n\t\treturn splitStr;\n\t}\n\n\t/**\n\t * Compares two variables; intended to be used as a smarter comparator.\n\t * The two variables must be the same type (TypeScript will not check this).\n\t *\n\t * - Numbers are sorted low-to-high, use `-val` to reverse\n\t * - Strings are sorted A to Z case-semi-insensitively, use `{reverse: val}` to reverse\n\t * - Booleans are sorted true-first (REVERSE of casting to numbers), use `!val` to reverse\n\t * - Arrays are sorted lexically in the order of their elements\n\t *\n\t * In other words: `[num, str]` will be sorted A to Z, `[num, {reverse: str}]` will be sorted Z to A.\n\t */\n\tcompare(a: Comparable, b: Comparable): number {\n\t\tif (typeof a === 'number') {\n\t\t\treturn a - (b as number);\n\t\t}\n\t\tif (typeof a === 'string') {\n\t\t\treturn a.localeCompare(b as string);\n\t\t}\n\t\tif (typeof a === 'boolean') {\n\t\t\treturn (a ? 1 : 2) - (b ? 1 : 2);\n\t\t}\n\t\tif (Array.isArray(a)) {\n\t\t\tfor (let i = 0; i < a.length; i++) {\n\t\t\t\tconst comparison = PSUtils.compare(a[i], (b as Comparable[])[i]);\n\t\t\t\tif (comparison) return comparison;\n\t\t\t}\n\t\t\treturn 0;\n\t\t}\n\t\tif (a.reverse) {\n\t\t\treturn PSUtils.compare((b as {reverse: string}).reverse, a.reverse);\n\t\t}\n\t\tthrow new Error(`Passed value ${a} is not comparable`);\n\t}\n\t/**\n\t * Sorts an array according to the callback's output on its elements.\n\t *\n\t * The callback's output is compared according to `PSUtils.compare` (in\n\t * particular, it supports arrays so you can sort by multiple things).\n\t */\n\tsortBy<T>(array: T[], callback: (a: T) => Comparable): T[];\n\t/**\n\t * Sorts an array according to `PSUtils.compare`. (Correctly sorts numbers,\n\t * unlike `array.sort`)\n\t */\n\tsortBy<T extends Comparable>(array: T[]): T[];\n\tsortBy<T>(array: T[], callback?: (a: T) => Comparable) {\n\t\tif (!callback) return (array as any[]).sort(PSUtils.compare);\n\t\treturn array.sort((a, b) => PSUtils.compare(callback(a), callback(b)));\n\t}\n};\n\n/**\n * Sanitize a room ID by removing anything that isn't alphanumeric or `-`.\n * Shouldn't actually do anything except against malicious input.\n */\nfunction toRoomid(roomid: string) {\n\treturn roomid.replace(/[^a-zA-Z0-9-]+/g, '').toLowerCase();\n}\n\nfunction toName(name: any) {\n\tif (typeof name !== 'string' && typeof name !== 'number') return '';\n\tname = ('' + name).replace(/[\\|\\s\\[\\]\\,\\u202e]+/g, ' ').trim();\n\tif (name.length > 18) name = name.substr(0, 18).trim();\n\n\t// remove zalgo\n\tname = name.replace(\n\t\t/[\\u0300-\\u036f\\u0483-\\u0489\\u0610-\\u0615\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06ED\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E]{3,}/g,\n\t\t''\n\t);\n\tname = name.replace(/[\\u239b-\\u23b9]/g, '');\n\n\treturn name;\n}\n\ninterface SpriteData {\n\tw: number;\n\th: number;\n\ty?: number;\n\tgen?: number;\n\turl?: string;\n\trawHTML?: string;\n\tpixelated?: boolean;\n\tisFrontSprite?: boolean;\n\tcryurl?: string;\n\tshiny?: boolean;\n}\n\ninterface TeambuilderSpriteData {\n\tx: number;\n\ty: number;\n\tspriteDir: string;\n\tspriteid: string;\n\tshiny?: boolean;\n}\n\nconst Dex = new class implements ModdedDex {\n\treadonly gen = 8;\n\treadonly modid = 'gen8' as ID;\n\treadonly cache = null!;\n\n\treadonly statNames: ReadonlyArray<StatName> = ['hp', 'atk', 'def', 'spa', 'spd', 'spe'];\n\treadonly statNamesExceptHP: ReadonlyArray<StatNameExceptHP> = ['atk', 'def', 'spa', 'spd', 'spe'];\n\n\tpokeballs: string[] | null = null;\n\n\treadonly modResourcePrefix = 'https://raw.githubusercontent.com/scoopapa/dh/master/data/mods/';\n\tresourcePrefix = (() => {\n\t\tlet prefix = '';\n\t\tif (window.document?.location?.protocol !== 'http:') prefix = 'https:';\n\t\treturn `${prefix}//${'play.pokemonshowdown.com'}/`;\n\t})();\n\n\tfxPrefix = (() => {\n\t\tif (window.document?.location?.protocol === 'file:') {\n\t\t\tif (window.Replays) return `https://${'play.pokemonshowdown.com'}/fx/`;\n\t\t\treturn `fx/`;\n\t\t}\n\t\treturn `//${'play.pokemonshowdown.com'}/fx/`;\n\t})();\n\n\tloadedSpriteData = {xy: 1, bw: 0};\n\tmoddedDexes: {[mod: string]: ModdedDex} = {};\n\n\tmod(modid: ID): ModdedDex {\n\t\tif (modid === 'gen8') return this;\n\t\tif (!window.BattleTeambuilderTable) return this;\n\t\tif (modid in this.moddedDexes) {\n\t\t\treturn this.moddedDexes[modid];\n\t\t}\n\t\tthis.moddedDexes[modid] = new ModdedDex(modid);\n\t\treturn this.moddedDexes[modid];\n\t}\n\tforGen(gen: number) {\n\t\tif (!gen) return this;\n\t\treturn this.mod(`gen${gen}` as ID);\n\t}\n\n\tresolveAvatar(avatar: string): string {\n\t\tif (window.BattleAvatarNumbers && avatar in BattleAvatarNumbers) {\n\t\t\tavatar = BattleAvatarNumbers[avatar];\n\t\t}\n\t\tif (avatar.charAt(0) === '#') {\n\t\t\treturn Dex.resourcePrefix + 'sprites/trainers-custom/' + toID(avatar.substr(1)) + '.png';\n\t\t}\n\t\tif (avatar.includes('.') && window.Config?.server?.registered) {\n\t\t\t// custom avatar served by the server\n\t\t\tlet protocol = (Config.server.port === 443) ? 'https' : 'http';\n\t\t\treturn protocol + '://' + Config.server.host + ':' + Config.server.port +\n\t\t\t\t'/avatars/' + encodeURIComponent(avatar).replace(/\\%3F/g, '?');\n\t\t}\n\t\treturn Dex.resourcePrefix + 'sprites/trainers/' + Dex.sanitizeName(avatar || 'unknown') + '.png';\n\t}\n\n\t/**\n\t * This is used to sanitize strings from data files like `moves.js` and\n\t * `teambuilder-tables.js`.\n\t *\n\t * This makes sure untrusted strings can't wreak havoc if someone forgets to\n\t * escape it before putting it in HTML.\n\t *\n\t * None of these characters belong in these files, anyway. (They can be used\n\t * in move descriptions, but those are served from `text.js`, which are\n\t * definitely always treated as unsanitized.)\n\t */\n\tsanitizeName(name: any) {\n\t\tif (!name) return '';\n\t\treturn ('' + name)\n\t\t\t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;')\n\t\t\t.slice(0, 50);\n\t}\n\n\tprefs(prop: string) {\n\t\t// @ts-ignore\n\t\treturn window.Storage?.prefs?.(prop);\n\t}\n\n\tgetShortName(name: string) {\n\t\tlet shortName = name.replace(/[^A-Za-z0-9]+$/, '');\n\t\tif (shortName.indexOf('(') >= 0) {\n\t\t\tshortName += name.slice(shortName.length).replace(/[^\\(\\)]+/g, '').replace(/\\(\\)/g, '');\n\t\t}\n\t\treturn shortName;\n\t}\n\n\tgetEffect(name: string | null | undefined): PureEffect | Item | Ability | Move {\n\t\tname = (name || '').trim();\n\t\tif (name.substr(0, 5) === 'item:') {\n\t\t\treturn Dex.getItem(name.substr(5).trim());\n\t\t} else if (name.substr(0, 8) === 'ability:') {\n\t\t\treturn Dex.getAbility(name.substr(8).trim());\n\t\t} else if (name.substr(0, 5) === 'move:') {\n\t\t\treturn Dex.getMove(name.substr(5).trim());\n\t\t}\n\t\tlet id = toID(name);\n\t\treturn new PureEffect(id, name);\n\t}\n\n\tgetMove(nameOrMove: string | Move | null | undefined): Move {\n\t\tif (nameOrMove && typeof nameOrMove !== 'string') {\n\t\t\t// TODO: don't accept Moves here\n\t\t\treturn nameOrMove;\n\t\t}\n\t\tlet name = nameOrMove || '';\n\t\tlet id = toID(nameOrMove);\n\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\tname = BattleAliases[id];\n\t\t\tid = toID(name);\n\t\t}\n\t\tif (!window.BattleMovedex) window.BattleMovedex = {};\n\t\tlet data = window.BattleMovedex[id];\n\t\tif (data && typeof data.exists === 'boolean') return data;\n\n\t\tif (!data && id.substr(0, 11) === 'hiddenpower' && id.length > 11) {\n\t\t\tlet [, hpWithType, hpPower] = /([a-z]*)([0-9]*)/.exec(id)!;\n\t\t\tdata = {\n\t\t\t\t...(window.BattleMovedex[hpWithType] || {}),\n\t\t\t\tbasePower: Number(hpPower) || 60,\n\t\t\t};\n\t\t}\n\t\tif (!data && id.substr(0, 6) === 'return' && id.length > 6) {\n\t\t\tdata = {\n\t\t\t\t...(window.BattleMovedex['return'] || {}),\n\t\t\t\tbasePower: Number(id.slice(6)),\n\t\t\t};\n\t\t}\n\t\tif (!data && id.substr(0, 11) === 'frustration' && id.length > 11) {\n\t\t\tdata = {\n\t\t\t\t...(window.BattleMovedex['frustration'] || {}),\n\t\t\t\tbasePower: Number(id.slice(11)),\n\t\t\t};\n\t\t}\n\n\t\tif (!data) data = {exists: false};\n\t\tlet move = new Move(id, name, data);\n\t\twindow.BattleMovedex[id] = move;\n\t\treturn move;\n\t}\n\n\tgetGen3Category(type: string) {\n\t\treturn [\n\t\t\t'Fire', 'Water', 'Grass', 'Electric', 'Ice', 'Psychic', 'Dark', 'Dragon',\n\t\t].includes(type) ? 'Special' : 'Physical';\n\t}\n\n\tgetItem(nameOrItem: string | Item | null | undefined): Item {\n\t\tif (nameOrItem && typeof nameOrItem !== 'string') {\n\t\t\t// TODO: don't accept Items here\n\t\t\treturn nameOrItem;\n\t\t}\n\t\tlet name = nameOrItem || '';\n\t\tlet id = toID(nameOrItem);\n\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\tname = BattleAliases[id];\n\t\t\tid = toID(name);\n\t\t}\n\t\tif (!window.BattleItems) window.BattleItems = {};\n\t\tlet data = window.BattleItems[id];\n\t\tif (data && typeof data.exists === 'boolean') return data;\n\t\tif (!data) data = {exists: false};\n\t\tlet item = new Item(id, name, data);\n\t\twindow.BattleItems[id] = item;\n\t\treturn item;\n\t}\n\n\tgetAbility(nameOrAbility: string | Ability | null | undefined): Ability {\n\t\tif (nameOrAbility && typeof nameOrAbility !== 'string') {\n\t\t\t// TODO: don't accept Abilities here\n\t\t\treturn nameOrAbility;\n\t\t}\n\t\tlet name = nameOrAbility || '';\n\t\tlet id = toID(nameOrAbility);\n\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\tname = BattleAliases[id];\n\t\t\tid = toID(name);\n\t\t}\n\t\tif (!window.BattleAbilities) window.BattleAbilities = {};\n\t\tlet data = window.BattleAbilities[id];\n\t\tif (data && typeof data.exists === 'boolean') return data;\n\t\tif (!data) data = {exists: false};\n\t\tlet ability = new Ability(id, name, data);\n\t\twindow.BattleAbilities[id] = ability;\n\t\treturn ability;\n\t}\n\n\tgetSpecies(nameOrSpecies: string | Species | null | undefined): Species {\n\t\tif (nameOrSpecies && typeof nameOrSpecies !== 'string') {\n\t\t\t// TODO: don't accept Species' here\n\t\t\treturn nameOrSpecies;\n\t\t}\n\t\tlet name = nameOrSpecies || '';\n\t\tlet id = toID(nameOrSpecies);\n\t\tlet formid = id;\n\t\tif (!window.BattlePokedexAltForms) window.BattlePokedexAltForms = {};\n\t\tif (formid in window.BattlePokedexAltForms) return window.BattlePokedexAltForms[formid];\n\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\tname = BattleAliases[id];\n\t\t\tid = toID(name);\n\t\t} else if (window.BattlePokedex && !(id in BattlePokedex) && window.BattleBaseSpeciesChart) {\n\t\t\tfor (const baseSpeciesId of BattleBaseSpeciesChart) {\n\t\t\t\tif (formid.startsWith(baseSpeciesId)) {\n\t\t\t\t\tid = baseSpeciesId;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (!window.BattlePokedex) window.BattlePokedex = {};\n\t\tlet data = window.BattlePokedex[id];\n\n\t\tlet species: Species;\n\t\tif (data && typeof data.exists === 'boolean') {\n\t\t\tspecies = data;\n\t\t} else {\n\t\t\tif (!data) data = {exists: false};\n\t\t\tif (!data.tier && id.slice(-5) === 'totem') {\n\t\t\t\tdata.tier = this.getSpecies(id.slice(0, -5)).tier;\n\t\t\t}\n\t\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\n\t\t\t\tdata.tier = this.getSpecies(data.baseSpecies).tier;\n\t\t\t}\n\t\t\tspecies = new Species(id, name, data);\n\t\t\twindow.BattlePokedex[id] = species;\n\t\t}\n\n\t\tif (species.cosmeticFormes) {\n\t\t\tfor (const forme of species.cosmeticFormes) {\n\t\t\t\tif (toID(forme) === formid) {\n\t\t\t\t\tspecies = new Species(formid, name, {\n\t\t\t\t\t\t...species,\n\t\t\t\t\t\tname: forme,\n\t\t\t\t\t\tforme: forme.slice(species.name.length + 1),\n\t\t\t\t\t\tbaseForme: \"\",\n\t\t\t\t\t\tbaseSpecies: species.name,\n\t\t\t\t\t\totherFormes: null,\n\t\t\t\t\t});\n\t\t\t\t\twindow.BattlePokedexAltForms[formid] = species;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn species;\n\t}\n\n\t/** @deprecated */\n\tgetTier(pokemon: string, genNum = 8, mod?: string): string {\n\t\tlet species = this.getSpecies(pokemon);\n\t\tif (genNum < 8) species = this.forGen(genNum).getSpecies(pokemon);\n\t\tlet table = window.BattleTeambuilderTable;\n\t\tif (!table) return species.tier;\n\t\tif (mod === 'doubles') {\n\t\t\ttable = table[`gen${genNum}doubles`];\n\t\t} else if (genNum < 8) {\n\t\t\ttable = table[`gen${genNum}`];\n\t\t} else if (mod && table[toID(mod)]) {\n\t\t\ttable = table[toID(mod)];\n\t\t}\n\n\t\tif (!table.overrideTier) return species.tier;\n\n\t\tlet id = species.id;\n\t\tif (id in table.overrideTier) {\n\t\t\treturn table.overrideTier[id];\n\t\t}\n\n\t\treturn species.tier;\n\t}\n\n\tgetType(type: any): Effect & {damageTaken?: AnyObject, HPivs?: Partial<StatsTable>, HPdvs: Partial<StatsTable>} {\n\t\tif (!type || typeof type === 'string') {\n\t\t\tlet id = toID(type) as string;\n\t\t\tid = id.substr(0, 1).toUpperCase() + id.substr(1);\n\t\t\ttype = (window.BattleTypeChart && window.BattleTypeChart[id]) || {};\n\t\t\tif (type.damageTaken) type.exists = true;\n\t\t\tif (!type.id) type.id = id;\n\t\t\tif (!type.name) type.name = id;\n\t\t\tif (!type.effectType) {\n\t\t\t\ttype.effectType = 'Type';\n\t\t\t}\n\t\t}\n\t\treturn type;\n\t}\n\n\thasAbility(species: Species, ability: string) {\n\t\tfor (const i in species.abilities) {\n\t\t\t// @ts-ignore\n\t\t\tif (ability === species.abilities[i]) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetSpriteMod(mod: string, id: string, folder: string, overrideStandard: boolean = false) {\n\t\tif (!window.ModSprites[id]) return '';\n\t\tif ((!mod || !window.ModSprites[id][mod]) && !overrideStandard) {\n\t\t\tfor (const modName in window.ModSprites[id]) {\n\t\t\t\tif (window.ModSprites[id][modName].includes(folder)) return modName;\n\t\t\t}\n\t\t}\n\t\tif (mod && window.ModSprites[id][mod] && window.ModSprites[id][mod].includes(folder)) return mod;\n\t\treturn '';\n\t}\n\n\tloadSpriteData(gen: 'xy' | 'bw') {\n\t\tif (this.loadedSpriteData[gen]) return;\n\t\tthis.loadedSpriteData[gen] = 1;\n\n\t\tlet path = $('script[src*=\"pokedex-mini.js\"]').attr('src') || '';\n\t\tlet qs = '?' + (path.split('?')[1] || '');\n\t\tpath = (path.match(/.+?(?=data\\/pokedex-mini\\.js)/) || [])[0] || '';\n\n\t\tlet el = document.createElement('script');\n\t\tel.src = path + 'data/pokedex-mini-bw.js' + qs;\n\t\tdocument.getElementsByTagName('body')[0].appendChild(el);\n\t}\n\n\tgetSpriteData(pokemon: Pokemon | Species | string, isFront: boolean, options: {\n\t\tgen?: number,\n\t\tshiny?: boolean,\n\t\tgender?: GenderName,\n\t\tafd?: boolean,\n\t\tnoScale?: boolean,\n\t\tmod: string,\n\t\tdynamax?: boolean,\n\t} = {gen: 6, mod: ''}) {\n\t\tlet mechanicsGen = options.gen || 6;\n\t\tif (options.mod && window.ModConfig[options.mod].spriteGen) mechanicsGen = window.ModConfig[options.mod].spriteGen;\n\t\tlet isDynamax = !!options.dynamax;\n\t\tif (pokemon instanceof Pokemon) {\n\t\t\tif (pokemon.volatiles.transform) {\n\t\t\t\toptions.shiny = pokemon.volatiles.transform[2];\n\t\t\t\toptions.gender = pokemon.volatiles.transform[3];\n\t\t\t} else {\n\t\t\t\toptions.shiny = pokemon.shiny;\n\t\t\t\toptions.gender = pokemon.gender;\n\t\t\t}\n\t\t\tif (pokemon.volatiles.dynamax) isDynamax = true;\n\t\t\tpokemon = pokemon.getSpeciesForme();\n\t\t}\n\t\tconst species = Dex.getSpecies(pokemon);\n\t\tlet resourcePrefix = Dex.resourcePrefix;\n\t\tlet spriteDir = 'sprites/';\n\t\tlet fakeSprite = false;\n\t\tlet name = species.spriteid;\n\t\tlet id = toID(name);\n\t\toptions.mod = this.getSpriteMod(options.mod, id, isFront ? 'front' : 'back', species.exists !== false);\n\t\tif (options.mod) {\n\t\t\tresourcePrefix = Dex.modResourcePrefix;\n\t\t\tspriteDir = `${options.mod}/sprites/`;\n\t\t\tfakeSprite = true;\n\t\t\tif (this.getSpriteMod(options.mod, id, (isFront ? 'front' : 'back') + '-shiny', species.exists !== false) === '') options.shiny = false;\n\t\t}\n\n\t\t// Gmax sprites are already extremely large, so we don't need to double.\n\t\tif (species.name.endsWith('-Gmax')) isDynamax = false;\n\t\tlet spriteData = {\n\t\t\tgen: mechanicsGen,\n\t\t\tw: 96,\n\t\t\th: 96,\n\t\t\ty: 0,\n\t\t\turl: resourcePrefix + spriteDir,\n\t\t\tpixelated: true,\n\t\t\tisFrontSprite: false,\n\t\t\tcryurl: '',\n\t\t\tshiny: options.shiny,\n\t\t};\n\t\t// console.log(spriteData.url);\n\n\t\tlet dir;\n\t\tlet facing;\n\t\tif (isFront) {\n\t\t\tspriteData.isFrontSprite = true;\n\t\t\tdir = '';\n\t\t\tfacing = 'front';\n\t\t} else {\n\t\t\tdir = '-back';\n\t\t\tfacing = 'back';\n\t\t}\n\t\tif (fakeSprite) dir = isFront ? 'front' : 'back';\n\t\t// Decide which gen sprites to use.\n\t\t//\n\t\t// There are several different generations we care about here:\n\t\t//\n\t\t//   - mechanicsGen: the generation number of the mechanics and battle (options.gen)\n\t\t//   - graphicsGen: the generation number of sprite/field graphics the user has requested.\n\t\t//     This will default to mechanicsGen, but may be altered depending on user preferences.\n\t\t//   - spriteData.gen: the generation number of a the specific Pokemon sprite in question.\n\t\t//     This defaults to graphicsGen, but if the graphicsGen doesn't have a sprite for the Pokemon\n\t\t//     (eg. Darmanitan in graphicsGen 2) then we go up gens until it exists.\n\t\t//\n\t\tlet graphicsGen = mechanicsGen;\n\t\tif (Dex.prefs('nopastgens')) graphicsGen = 6;\n\t\tif (Dex.prefs('bwgfx') && graphicsGen >= 6) graphicsGen = 5;\n\t\tspriteData.gen = Math.max(graphicsGen, Math.min(species.gen, 5));\n\t\tconst baseDir = ['', 'gen1', 'gen2', 'gen3', 'gen4', 'gen5', '', '', ''][spriteData.gen];\n\n\t\tlet animationData = null;\n\t\tlet miscData = null;\n\t\tlet speciesid = species.id;\n\t\tif (species.isTotem) speciesid = toID(name);\n\t\tif (baseDir === '' && window.BattlePokemonSprites) {\n\t\t\tanimationData = BattlePokemonSprites[speciesid];\n\t\t}\n\t\tif (baseDir === 'gen5' && window.BattlePokemonSpritesBW) {\n\t\t\tanimationData = BattlePokemonSpritesBW[speciesid];\n\t\t}\n\t\tif (window.BattlePokemonSprites) miscData = BattlePokemonSprites[speciesid];\n\t\tif (!miscData && window.BattlePokemonSpritesBW) miscData = BattlePokemonSpritesBW[speciesid];\n\t\tif (!animationData) animationData = {};\n\t\tif (!miscData) miscData = {};\n\n\t\tif (miscData.num !== 0 && miscData.num > -5000) {\n\t\t\tlet baseSpeciesid = toID(species.baseSpecies);\n\t\t\tspriteData.cryurl = 'audio/cries/' + baseSpeciesid;\n\t\t\tlet formeid = species.formeid;\n\t\t\tif (species.isMega || formeid && (\n\t\t\t\tformeid === '-sky' ||\n\t\t\t\tformeid === '-therian' ||\n\t\t\t\tformeid === '-primal' ||\n\t\t\t\tformeid === '-eternal' ||\n\t\t\t\tbaseSpeciesid === 'kyurem' ||\n\t\t\t\tbaseSpeciesid === 'necrozma' ||\n\t\t\t\tformeid === '-super' ||\n\t\t\t\tformeid === '-unbound' ||\n\t\t\t\tformeid === '-midnight' ||\n\t\t\t\tformeid === '-school' ||\n\t\t\t\tbaseSpeciesid === 'oricorio' ||\n\t\t\t\tbaseSpeciesid === 'zygarde'\n\t\t\t)) {\n\t\t\t\tspriteData.cryurl += formeid;\n\t\t\t}\n\t\t\tspriteData.cryurl += '.mp3';\n\t\t}\n\n\t\tif (options.shiny && mechanicsGen > 1) dir += '-shiny';\n\n\t\t// April Fool's 2014\n\t\tif (window.Config && Config.server && Config.server.afd || options.afd) {\n\t\t\tdir = 'afd' + dir;\n\t\t\tspriteData.url += dir + '/' + name + '.png';\n\t\t\t// Duplicate code but needed to make AFD tinymax work\n\t\t\t// April Fool's 2020\n\t\t\tif (isDynamax && !options.noScale) {\n\t\t\t\tspriteData.w *= 0.25;\n\t\t\t\tspriteData.h *= 0.25;\n\t\t\t\tspriteData.y += -22;\n\t\t\t} else if (species.isTotem && !options.noScale) {\n\t\t\t\tspriteData.w *= 0.5;\n\t\t\t\tspriteData.h *= 0.5;\n\t\t\t\tspriteData.y += -11;\n\t\t\t}\n\t\t\treturn spriteData;\n\t\t}\n\n\t\t// Mod Cries\n\t\tif (options.mod === 'digimon') {\n\t\t\tspriteData.cryurl = `sprites/${options.mod}/audio/${toID(species.baseSpecies)}`;\n\t\t\tspriteData.cryurl += '.mp3';\n\t\t}\n\n\t\tif (animationData[facing + 'f'] && options.gender === 'F') facing += 'f';\n\t\tlet allowAnim = !fakeSprite && !Dex.prefs('noanim') && !Dex.prefs('nogif');\n\t\tif (allowAnim && spriteData.gen >= 6) spriteData.pixelated = false;\n\t\tif (allowAnim && animationData[facing] && spriteData.gen >= 5) {\n\t\t\tif (facing.slice(-1) === 'f') name += '-f';\n\t\t\tdir = baseDir + 'ani' + dir;\n\n\t\t\tspriteData.w = animationData[facing].w;\n\t\t\tspriteData.h = animationData[facing].h;\n\t\t\tspriteData.url += dir + '/' + name + '.gif';\n\t\t} else {\n\t\t\t// There is no entry or enough data in pokedex-mini.js\n\t\t\t// Handle these in case-by-case basis; either using BW sprites or matching the played gen.\n\t\t\tif (!fakeSprite) dir = (baseDir || 'gen5') + dir;\n\n\t\t\t// Gender differences don't exist prior to Gen 4,\n\t\t\t// so there are no sprites for it\n\t\t\tif (spriteData.gen >= 4 && miscData['frontf'] && options.gender === 'F') {\n\t\t\t\tname += '-f';\n\t\t\t}\n\n\t\t\tspriteData.url += dir + '/' + name + '.png';\n\t\t}\n\n\t\tif (!options.noScale) {\n\t\t\tif (graphicsGen > 4) {\n\t\t\t\t// no scaling\n\t\t\t} else if (spriteData.isFrontSprite) {\n\t\t\t\tspriteData.w *= 2;\n\t\t\t\tspriteData.h *= 2;\n\t\t\t\tspriteData.y += -16;\n\t\t\t} else {\n\t\t\t\t// old gen backsprites are multiplied by 1.5x by the 3D engine\n\t\t\t\tspriteData.w *= 2 / 1.5;\n\t\t\t\tspriteData.h *= 2 / 1.5;\n\t\t\t\tspriteData.y += -11;\n\t\t\t}\n\t\t\tif (spriteData.gen <= 2) spriteData.y += 2;\n\t\t}\n\t\tif (isDynamax && !options.noScale) {\n\t\t\tspriteData.w *= 2;\n\t\t\tspriteData.h *= 2;\n\t\t\tspriteData.y += -22;\n\t\t} else if ((species.isTotem || isDynamax) && !options.noScale) {\n\t\t\tspriteData.w *= 1.5;\n\t\t\tspriteData.h *= 1.5;\n\t\t\tspriteData.y += -11;\n\t\t}\n\t\treturn spriteData;\n\t}\n\n\tgetPokemonIconNum(id: ID, isFemale?: boolean, facingLeft?: boolean) {\n\t\tlet num = 0;\n\t\tif (window.BattlePokemonSprites?.[id]?.num) {\n\t\t\tnum = BattlePokemonSprites[id].num;\n\t\t} else if (window.BattlePokedex?.[id]?.num) {\n\t\t\tnum = BattlePokedex[id].num;\n\t\t}\n\t\tif (num < 0) num = 0;\n\t\tif (num > 898) num = 0;\n\n\t\tif (window.BattlePokemonIconIndexes?.[id]) {\n\t\t\tnum = BattlePokemonIconIndexes[id];\n\t\t}\n\n\t\tif (isFemale) {\n\t\t\tif (['unfezant', 'frillish', 'jellicent', 'meowstic', 'pyroar'].includes(id)) {\n\t\t\t\tnum = BattlePokemonIconIndexes[id + 'f'];\n\t\t\t}\n\t\t}\n\t\tif (facingLeft) {\n\t\t\tif (BattlePokemonIconIndexesLeft[id]) {\n\t\t\t\tnum = BattlePokemonIconIndexesLeft[id];\n\t\t\t}\n\t\t}\n\t\treturn num;\n\t}\n\n\tgetPokemonIcon(pokemon: string | Pokemon | ServerPokemon | PokemonSet | null, facingLeft?: boolean, mod: string = '') {\n\t\tif (pokemon === 'pokeball') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -0px 4px`;\n\t\t} else if (pokemon === 'pokeball-statused') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -40px 4px`;\n\t\t} else if (pokemon === 'pokeball-fainted') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px;opacity:.4;filter:contrast(0)`;\n\t\t} else if (pokemon === 'pokeball-none') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px`;\n\t\t}\n\n\t\tlet id = toID(pokemon);\n\t\tif (!pokemon || typeof pokemon === 'string') pokemon = null;\n\t\t// @ts-ignore\n\t\tif (pokemon?.speciesForme) id = toID(pokemon.speciesForme);\n\t\t// @ts-ignore\n\t\tif (pokemon?.species) id = toID(pokemon.species);\n\t\t// @ts-ignore\n\t\tif (pokemon?.volatiles?.formechange && !pokemon.volatiles.transform) {\n\t\t\t// @ts-ignore\n\t\t\tid = toID(pokemon.volatiles.formechange[1]);\n\t\t}\n\t\tlet num = this.getPokemonIconNum(id, pokemon?.gender === 'F', facingLeft);\n\t\tlet top = Math.floor(num / 12) * 30;\n\t\tlet left = (num % 12) * 40;\n\t\tlet fainted = ((pokemon as Pokemon | ServerPokemon)?.fainted ? `;opacity:.3;filter:grayscale(100%) brightness(.5)` : ``);\n\t\tlet species = Dex.getSpecies(id);\n\t\tmod = this.getSpriteMod(mod, id, 'icons', species.exists !== false);\n\t\tif (mod) return `background:transparent url(${this.modResourcePrefix}${mod}/sprites/icons/${id}.png) no-repeat scroll -0px -0px${fainted}`;\n\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-sheet.png?v4) no-repeat scroll -${left}px -${top}px${fainted}`;\n\t}\n\n\tgetTeambuilderSpriteData(pokemon: any, gen: number = 0, mod: string = ''): TeambuilderSpriteData {\n\t\tlet id = toID(pokemon.species);\n\t\tlet spriteid = pokemon.spriteid;\n\t\tlet species = Dex.getSpecies(pokemon.species);\n\t\tif (pokemon.species && !spriteid) {\n\t\t\tspriteid = species.spriteid || toID(pokemon.species);\n\t\t}\n\t\tif (mod && window.ModConfig[mod].spriteGen) gen = window.ModConfig[mod].spriteGen;\n\t\tmod = this.getSpriteMod(mod, id, 'front', species.exists !== false);\n\t\tif (mod) {\n\t\t\treturn {\n\t\t\t\tspriteDir: `${mod}/sprites/front`,\n\t\t\t\tspriteid,\n\t\t\t\tshiny: (this.getSpriteMod(mod, id, 'front-shiny', species.exists !== false) !== null && pokemon.shiny),\n\t\t\t\tx: 10,\n\t\t\t\ty: 5,\n\t\t\t};\n\t\t}\n\t\tif (species.exists === false) return {spriteDir: 'sprites/gen5', spriteid: '0', x: 10, y: 5};\n\t\tconst spriteData: TeambuilderSpriteData = {\n\t\t\tspriteid,\n\t\t\tspriteDir: 'sprites/dex',\n\t\t\tx: -2,\n\t\t\ty: -3,\n\t\t};\n\t\tif (pokemon.shiny) spriteData.shiny = true;\n\t\tif (Dex.prefs('nopastgens')) gen = 6;\n\t\tlet xydexExists = (!species.isNonstandard || species.isNonstandard === 'Past') || [\n\t\t\t\"pikachustarter\", \"eeveestarter\", \"meltan\", \"melmetal\", \"fidgit\", \"stratagem\", \"tomohawk\", \"mollux\", \"crucibelle\", \"crucibellemega\", \"kerfluffle\", \"pajantom\", \"jumbao\", \"caribolt\", \"smokomodo\", \"snaelstrom\", \"equilibra\", \"astrolotl\", \"scratchet\", \"pluffle\", \"smogecko\", \"pokestarufo\", \"pokestarufo2\", \"pokestarbrycenman\", \"pokestarmt\", \"pokestarmt2\", \"pokestargiant\", \"pokestarhumanoid\", \"pokestarmonster\", \"pokestarf00\", \"pokestarf002\", \"pokestarspirit\",\n\t\t].includes(species.id);\n\t\tif (species.gen === 8) xydexExists = false;\n\t\tif ((!gen || gen >= 6) && xydexExists) {\n\t\t\tif (species.gen >= 7) {\n\t\t\t\tspriteData.x = -6;\n\t\t\t\tspriteData.y = -7;\n\t\t\t} else if (id.substr(0, 6) === 'arceus') {\n\t\t\t\tspriteData.x = -2;\n\t\t\t\tspriteData.y = 7;\n\t\t\t} else if (id === 'garchomp') {\n\t\t\t\tspriteData.x = -2;\n\t\t\t\tspriteData.y = 2;\n\t\t\t} else if (id === 'garchompmega') {\n\t\t\t\tspriteData.x = -2;\n\t\t\t\tspriteData.y = 0;\n\t\t\t}\n\t\t\treturn spriteData;\n\t\t}\n\t\tspriteData.spriteDir = 'sprites/gen5';\n\t\tif (gen <= 1 && species.gen <= 1) spriteData.spriteDir = 'sprites/gen1';\n\t\telse if (gen <= 2 && species.gen <= 2) spriteData.spriteDir = 'sprites/gen2';\n\t\telse if (gen <= 3 && species.gen <= 3) spriteData.spriteDir = 'sprites/gen3';\n\t\telse if (gen <= 4 && species.gen <= 4) spriteData.spriteDir = 'sprites/gen4';\n\t\tspriteData.x = 10;\n\t\tspriteData.y = 5;\n\t\treturn spriteData;\n\t}\n\n\tgetTeambuilderSprite(pokemon: any, gen: number = 0, mod: string = '') {\n\t\tif (!pokemon) return '';\n\t\tconst data = this.getTeambuilderSpriteData(pokemon, gen, mod);\n\t\tconst shiny = (data.shiny ? '-shiny' : '');\n\t\tlet resourcePrefix = Dex.resourcePrefix;\n\t\tif (data.spriteDir.includes('front')) resourcePrefix = Dex.modResourcePrefix;\n\t\treturn 'background-image:url(' + resourcePrefix + data.spriteDir + shiny + '/' + data.spriteid + '.png);background-position:' + data.x + 'px ' + data.y + 'px;background-repeat:no-repeat';\n\t}\n\n\tgetItemIcon(item: any, mod: string = '') {\n\t\tlet num = 0;\n\t\tif (typeof item === 'string' && exports.BattleItems) item = exports.BattleItems[toID(item)];\n\t\tmod = this.getSpriteMod(mod, item.id, 'items');\n\t\tif (mod) return `background:transparent url(${this.modResourcePrefix}${mod}/sprites/items/${item.id}.png) no-repeat`;\n\t\tif (item?.spritenum) num = item.spritenum;\n\n\t\tlet top = Math.floor(num / 16) * 24;\n\t\tlet left = (num % 16) * 24;\n\t\treturn 'background:transparent url(' + Dex.resourcePrefix + 'sprites/itemicons-sheet.png?g8) no-repeat scroll -' + left + 'px -' + top + 'px';\n\t}\n\n\tgetTypeIcon(type: string | null, b?: boolean, mod: string = '') { // b is just for utilichart.js\n\t\ttype = this.getType(type).name;\n\t\tif (!type) type = '???';\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\n\t\t// console.log(sanitizedType);\n\t\tmod = this.getSpriteMod(mod, toID(type), 'types');\n\t\tif (mod) {\n\t\t\treturn `<img src=\"${this.modResourcePrefix}${mod}/sprites/types/${toID(type)}.png\" alt=\"${type}\" class=\"pixelated${b ? ' b' : ''}\" />`;\n\t\t} else {\n\t\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/types/${sanitizedType}.png\" alt=\"${type}\" height=\"14\" width=\"32\" class=\"pixelated${b ? ' b' : ''}\" />`;\n\t\t}\n\t}\n\n\tgetCategoryIcon(category: string | null) {\n\t\tconst categoryID = toID(category);\n\t\tlet sanitizedCategory = '';\n\t\tswitch (categoryID) {\n\t\tcase 'physical':\n\t\tcase 'special':\n\t\tcase 'status':\n\t\t\tsanitizedCategory = categoryID.charAt(0).toUpperCase() + categoryID.slice(1);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tsanitizedCategory = 'undefined';\n\t\t\tbreak;\n\t\t}\n\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/categories/${sanitizedCategory}.png\" alt=\"${sanitizedCategory}\" height=\"14\" width=\"32\" class=\"pixelated\" />`;\n\t}\n\n\tgetPokeballs() {\n\t\tif (this.pokeballs) return this.pokeballs;\n\t\tthis.pokeballs = [];\n\t\tif (!window.BattleItems) window.BattleItems = {};\n\t\tfor (const data of Object.values(window.BattleItems) as AnyObject[]) {\n\t\t\tif (!data.isPokeball) continue;\n\t\t\tthis.pokeballs.push(data.name);\n\t\t}\n\t\treturn this.pokeballs;\n\t}\n};\n\nclass ModdedDex {\n\tgen: number;\n\treadonly modid: ID;\n\treadonly cache = {\n\t\tMoves: {} as any as {[k: string]: Move},\n\t\tItems: {} as any as {[k: string]: Item},\n\t\tAbilities: {} as any as {[k: string]: Ability},\n\t\tSpecies: {} as any as {[k: string]: Species},\n\t\tTypes: {} as any as {[k: string]: Effect},\n\t};\n\tpokeballs: string[] | null = null;\n\tconstructor(modid: ID) {\n\t\tthis.modid = modid;\n\t\tif (!modid.startsWith('gen')) {\n\t\t\tthis.gen = 8;\n\t\t} else {\n\t\t\tthis.gen = parseInt(modid.slice(3), 10);\n\t\t}\n\t}\n\tgetMove(name: string): Move {\n\t\tlet id = toID(name);\n\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\tname = BattleAliases[id];\n\t\t\tid = toID(name);\n\t\t}\n\t\tif (this.cache.Moves.hasOwnProperty(id)) return this.cache.Moves[id];\n\n\t\tlet data = {...Dex.getMove(name)};\n\n\t\tconst table = window.BattleTeambuilderTable[this.modid];\n\t\tif (table.overrideMoveInfo[id]) {\n\t\t\tfor (const key in table.overrideMoveInfo[id]) {\n\t\t\t\tdata = {...Dex.getMove(name), ...table.overrideMoveInfo[id]};\n\t\t\t}\n\t\t}\n\t\tif (this.gen <= 3 && data.category !== 'Status') {\n\t\t\tdata.category = Dex.getGen3Category(data.type);\n\t\t}\n\t\tconst move = new Move(id, name, data);\n\t\tthis.cache.Moves[id] = move;\n\t\treturn move;\n\t}\n\tgetItem(name: string): Item {\n\t\tlet id = toID(name);\n\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\tname = BattleAliases[id];\n\t\t\tid = toID(name);\n\t\t}\n\t\tif (this.cache.Items.hasOwnProperty(id)) return this.cache.Items[id];\n\t\tconst table = window.BattleTeambuilderTable[this.modid];\n\t\tlet data = {...Dex.getItem(name)};\n\t\tif (table.fullItemName && id in table.fullItemName) {\n\t\t\tdata.name = table.fullItemName[id];\n\t\t\tdata.exists = true;\n\t\t}\n\t\tif (id in table.overrideItemDesc) data.shortDesc = table.overrideItemDesc[id];\n\t\tfor (let i = this.gen; i < 8; i++) {\n\t\t\tif (id in window.BattleTeambuilderTable['gen' + i].overrideItemDesc) {\n\t\t\t\tdata.shortDesc = window.BattleTeambuilderTable['gen' + i].overrideItemDesc[id];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tconst item = new Item(id, name, data);\n\t\tthis.cache.Items[id] = item;\n\t\treturn item;\n\t}\n\tgetAbility(name: string): Ability {\n\t\tlet id = toID(name);\n\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\tname = BattleAliases[id];\n\t\t\tid = toID(name);\n\t\t}\n\t\tif (this.cache.Abilities.hasOwnProperty(id)) return this.cache.Abilities[id];\n\t\tlet table = BattleTeambuilderTable[this.modid];\n\t\tlet data = {...Dex.getAbility(name)};\n\t\tif (table.fullAbilityName && id in table.fullAbilityName) {\n\t\t\tdata.name = table.fullAbilityName[id];\n\t\t\tdata.exists = true;\n\t\t}\n\t\tif (id in table.overrideAbilityDesc) {\n\t\t\tdata.shortDesc = table.overrideAbilityDesc[id];\n\t\t} else {\n\t\t\tfor (let i = this.gen; i < 8; i++) {\n\t\t\t\tif (id in window.BattleTeambuilderTable['gen' + i].overrideAbilityDesc) {\n\t\t\t\t\tdata.shortDesc = window.BattleTeambuilderTable['gen' + i].overrideAbilityDesc[id];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst ability = new Ability(id, name, data);\n\t\tthis.cache.Abilities[id] = ability;\n\t\treturn ability;\n\t}\n\tgetSpecies(name: string): Species {\n\t\tlet id = toID(name);\n\t\tconst table = window.BattleTeambuilderTable[this.modid];\n\t\t// if (window.BattleAliases && id in BattleAliases && !table.overrideDexInfo[id]) {\n\t\t\t// name = BattleAliases[id];\n\t\t\t// id = toID(name);\n\t\t// }\n\t\tif (this.cache.Species.hasOwnProperty(id)) return this.cache.Species[id];\n\t\tlet data = {...Dex.getSpecies(name)};\n\t\tif (table.overrideDexInfo[id]) {\n\t\t\tfor (const key in table.overrideDexInfo[id]) {\n\t\t\t\tdata = {...Dex.getSpecies(name), ...table.overrideDexInfo[id]};\n\t\t\t}\n\t\t}\n\t\tif (this.gen < 3) {\n\t\t\tdata.abilities = {0: \"None\"};\n\t\t}\n\n\t\tif (id in table.overrideTier) data.tier = table.overrideTier[id];\n\t\tif (!data.tier && id.slice(-5) === 'totem') {\n\t\t\tdata.tier = this.getSpecies(id.slice(0, -5)).tier;\n\t\t}\n\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\n\t\t\tdata.tier = this.getSpecies(data.baseSpecies).tier;\n\t\t}\n\t\tif (data.gen > this.gen) data.tier = 'Illegal';\n\t\tconst species = new Species(id, name, data);\n\t\tthis.cache.Species[id] = species;\n\t\treturn species;\n\t}\n\tgetType(name: string): Effect {\n\t\tlet id = toID(name) as string;\n\t\tid = id.substr(0, 1).toUpperCase() + id.substr(1);\n\n\t\tif (this.cache.Types.hasOwnProperty(id)) return this.cache.Types[id];\n\n\t\tlet data = {...Dex.getType(name)};\n\n\t\tfor (let i = 7; i >= this.gen; i--) {\n\t\t\tif (id in window.BattleTeambuilderTable['gen' + i].removeType) {\n\t\t\t\tdata.exists = false;\n\t\t\t\t// don't bother correcting its attributes given it doesn't exist\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (id in window.BattleTeambuilderTable['gen' + i].overrideTypeChart) {\n\t\t\t\tdata = {...data, ...window.BattleTeambuilderTable['gen' + i].overrideTypeChart[id]};\n\t\t\t}\n\t\t}\n\n\t\tthis.cache.Types[id] = data;\n\t\treturn data;\n\t}\n\tgetPokeballs() {\n\t\tif (this.pokeballs) return this.pokeballs;\n\t\tthis.pokeballs = [];\n\t\tif (!window.BattleItems) window.BattleItems = {};\n\t\tfor (const data of Object.values(window.BattleItems) as AnyObject[]) {\n\t\t\tif (data.gen && data.gen > this.gen) continue;\n\t\t\tif (!data.isPokeball) continue;\n\t\t\tthis.pokeballs.push(data.name);\n\t\t}\n\t\treturn this.pokeballs;\n\t}\n}\n\nif (typeof require === 'function') {\n\t// in Node\n\t(global as any).Dex = Dex;\n\t(global as any).toID = toID;\n}\n"],"file":"battle-dex.js"}