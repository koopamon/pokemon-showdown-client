{"version":3,"sources":["../src/panel-battle.tsx"],"names":["BattlesRoom","options","classType","format","battles","refresh","setFormat","update","PS","send","toID","PSRoom","BattlesPanel","props","room","changeFormat","e","value","target","renderBattleLink","battle","id","split","minEloMessage","minElo","p1","p2","render","Dex","getPokemonIcon","length","map","PSRoomPanel","BattleRoom","side","request","choices","handleMessage","line","startsWith","spaceIndex","indexOf","cmd","slice","play","pause","turnNum","Number","charAt","turn","isNaN","receiveLine","seekTurn","switchSides","isDone","isEmpty","BattleChoiceBuilder","possibleError","addChoice","toString","ChatRoom","BattleDiv","shouldComponentUpdate","preact","Component","MoveButton","type","tooltip","children","moveData","pp","maxpp","PokemonButton","pokemon","disabled","opacity","hpColorClass","BattleScene","getHPColor","name","noHPBar","fainted","width","Math","round","hp","maxhp","status","BattlePanel","text","focusIfNoSelection","selection","window","getSelection","focus","onKey","keyCode","chatLog","base","getElementsByClassName","scrollTop","offsetHeight","toggleBoostedMove","checkbox","currentTarget","current","mega","checked","ultra","z","max","querySelector","componentDidMount","$elem","$","Battle","$frame","find","$logFrame","scene","tooltips","listen","subscribe","forceUpdate","args","Infinity","receiveRequest","JSON","parse","instantAdd","join","add","fixRequest","myPokemon","sidesSwitched","renderControls","renderPlayerControls","atEnd","atQueueEnd","paused","renderMoveControls","dex","pokemonIndex","index","active","currentMoveRequest","maxMoves","canDynamax","moves","i","move","getMove","maxMoveData","gmaxTooltip","zMoves","zMoveData","renderMoveTargetControls","moveTarget","getChosenMove","moveChoice","stringChoice","userSlot","userSlotCross","farSide","abs","reverse","nearSide","renderSwitchControls","numActive","requestLength","trapped","serverPokemon","cantSwitch","alreadySwitchingIn","includes","renderTeamControls","renderTeamList","team","renderChosenTeam","slot","renderOldChoices","requestType","buf","noCancel","choiceString","choice","parseChoice","choiceType","push","canGigantamax","targetLoc","targetPokemon","moveRequest","alreadyMax","canMegaEvo","alreadyMega","canZMove","alreadyZ","moveName","canShift","gameType","canUltraBurst","roomTypes","Model","updateRoomTypes"],"mappings":"2KAAA;AACA;AACA;AACA;AACA;AACA,G;;;;;;;;;AASMA,W;;;;;AAKL,qBAAYC,OAAZ,CAAkC;AACjC,wBAAMA,OAAN,QADiC,MAJzBC,SAIyB,CAJb,SAIa,OAFlCC,MAEkC,CAFzB,EAEyB,OADlCC,OACkC,CADH,IACG;AAEjC,MAAKC,OAAL,GAFiC;AAGjC,C;AACDC,S,CAAA,mBAAUH,MAAV,CAA0B;AACzB,GAAIA,MAAM,GAAK,KAAKA,MAApB,CAA4B,MAAO,MAAKE,OAAL,EAAP;AAC5B,KAAKD,OAAL,CAAe,IAAf;AACA,KAAKD,MAAL,CAAcA,MAAd;AACA,KAAKI,MAAL,CAAY,IAAZ;AACA,KAAKF,OAAL;AACA,C;AACDA,O,CAAA,kBAAU;AACTG,EAAE,CAACC,IAAH,mBAA0BC,IAAI,CAAC,KAAKP,MAAN,CAA9B;AACA,C,sBAlBwBQ,M;;;AAqBpBC,Y;AACLP,O,CAAU,UAAM;AACf,OAAKQ,KAAL,CAAWC,IAAX,CAAgBT,OAAhB;AACA,C;AACDU,Y,CAAe,SAACC,CAAD,CAAc;AAC5B,GAAMC,CAAAA,KAAK,CAAID,CAAC,CAACE,MAAH,CAAgCD,KAA9C;AACA,OAAKJ,KAAL,CAAWC,IAAX,CAAgBR,SAAhB,CAA0BW,KAA1B;AACA,C;AACDE,gB,CAAA,0BAAiBC,MAAjB,CAAqC;AACpC,GAAMjB,CAAAA,MAAM,CAAGiB,MAAM,CAACC,EAAP,CAAUC,KAAV,CAAgB,GAAhB,EAAqB,CAArB,CAAf;AACA,GAAMC,CAAAA,aAAa,CAAG,MAAOH,CAAAA,MAAM,CAACI,MAAd,GAAyB,QAAzB,UAA6CJ,MAAM,CAACI,MAApD,CAA+DJ,MAAM,CAACI,MAA5F;AACA,MAAO,qBAAK,cAAG,IAAI,KAAMJ,MAAM,CAACC,EAApB,CAA0B,QAAM,WAAhC;AACVE,aAAa,EAAI,kBAAO,KAAK,CAAC,aAAb,MAA6BA,aAA7B,KADP;AAEX,0BAASpB,MAAT,KAFW,CAEc,mBAFd;AAGX,eAAI,QAAM,IAAV,EAAgBiB,MAAM,CAACK,EAAvB,CAHW,KAGqB,kBAAO,QAAM,IAAb,QAHrB,KAGmD,eAAI,QAAM,IAAV,EAAgBL,MAAM,CAACM,EAAvB,CAHnD,CAAL,CAAP;;AAKA,C;AACDC,M,CAAA,iBAAS;AACR,GAAMb,CAAAA,IAAI,CAAG,KAAKD,KAAL,CAAWC,IAAxB;AACA,MAAO,UAAC,cAAD,EAAgB,IAAI,CAAEA,IAAtB,CAA4B,UAAU,KAAtC,EAAuC,gBAAK,QAAM,KAAX;AAC7C,mBAAQ,QAAM,QAAd,CAAuB,KAAK,CAAC,2CAA7B,CAAyE,IAAI,CAAC,OAA9E,EAAsF,cAAG,QAAM,aAAT,EAAtF,UAD6C;AAE7C,gBAAK,QAAM,UAAX;AACC;AACC,mBAAQ,QAAM,QAAd,CAAuB,IAAI,CAAC,SAA5B,CAAsC,OAAO,CAAE,KAAKT,OAApD,EAA6D,cAAG,QAAM,eAAT,EAA7D,YADD,KAC6G,iBAAM,KAAK,CAAEuB,GAAG,CAACC,cAAJ,CAAmB,oBAAnB,EAA2C,6CAAxD,CAAuG,QAAM,OAA7G,CAAqH,KAAK,CAAC,4FAA3H,EAD7G,CADD;;;AAKC;AACC,kBAAO,QAAM,OAAb,YADD,CACqC,SAAC,cAAD,EAAgB,QAAQ,CAAE,KAAKd,YAA/B,EADrC,CALD;;;;;;;;;AAeC,gBAAK,QAAM,MAAX,EAAmB,CAACD,IAAI,CAACV,OAAN;AAClB,+BADkB;AAEjB,CAACU,IAAI,CAACV,OAAL,CAAa0B,MAAd;AACD,4CADC;;AAGDhB,IAAI,CAACV,OAAL,CAAa2B,GAAb,CAAiB,SAAAX,MAAM,QAAI,CAAA,MAAI,CAACD,gBAAL,CAAsBC,MAAtB,CAAJ,EAAvB,CALD,CAfD,CAF6C,CAAvC,CAAP;;;;AA0BA,C,uBA7CyBY,W;;;AAgDrBC,U;AACI/B,S,CAAY,Q;;;;;;AAMrBkB,M,CAAiB,I;;AAEjBc,I,CAAqC,I;AACrCC,O,CAAgC,I;AAChCC,O,CAAsC,I;;;;;AAKtCC,a,CAAA,uBAAcC,IAAd,CAA4B;AAC3B,GAAI,CAACA,IAAI,CAACC,UAAL,CAAgB,GAAhB,CAAD,EAAyBD,IAAI,CAACC,UAAL,CAAgB,IAAhB,CAA7B,CAAoD,MAAO,MAAP;AACpD,GAAMC,CAAAA,UAAU,CAAGF,IAAI,CAACG,OAAL,CAAa,GAAb,CAAnB;AACA,GAAMC,CAAAA,GAAG,CAAGF,UAAU,EAAI,CAAd,CAAkBF,IAAI,CAACK,KAAL,CAAW,CAAX,CAAcH,UAAd,CAAlB,CAA8CF,IAAI,CAACK,KAAL,CAAW,CAAX,CAA1D;AACA,GAAMzB,CAAAA,MAAM,CAAGsB,UAAU,EAAI,CAAd,CAAkBF,IAAI,CAACK,KAAL,CAAWH,UAAU,CAAG,CAAxB,CAAlB,CAA+C,EAA9D;AACA,OAAQE,GAAR;AACA,IAAK,MAAL,CAAa;AACZ,KAAKtB,MAAL,CAAYwB,IAAZ;AACA,KAAKrC,MAAL,CAAY,IAAZ;AACA,MAAO,KAAP;AACA,CAAC,IAAK,OAAL,CAAc;AACf,KAAKa,MAAL,CAAYyB,KAAZ;AACA,KAAKtC,MAAL,CAAY,IAAZ;AACA,MAAO,KAAP;AACA,CAAC,IAAK,MAAL,CAAa,IAAK,cAAL,CAAqB;AACnC,GAAIuC,CAAAA,OAAO,CAAGC,MAAM,CAAC7B,MAAD,CAApB;AACA,GAAIA,MAAM,CAAC8B,MAAP,CAAc,CAAd,IAAqB,GAArB,EAA4BF,OAAO,CAAG,CAA1C,CAA6C;AAC5CA,OAAO,EAAI,KAAK1B,MAAL,CAAY6B,IAAvB;AACA,GAAIH,OAAO,CAAG,CAAd,CAAiBA,OAAO,CAAG,CAAV;AACjB,CAHD,IAGO,IAAI5B,MAAM,GAAK,KAAf,CAAsB;AAC5B4B,OAAO,CAAG,CAAC,CAAX;AACA;AACD,GAAII,KAAK,CAACJ,OAAD,CAAT,CAAoB;AACnB,KAAKK,WAAL,CAAiB,yCAA0CjC,MAA1C,CAAjB;AACA,MAAO,KAAP;AACA;AACD,KAAKE,MAAL,CAAYgC,QAAZ,CAAqBN,OAArB;AACA,KAAKvC,MAAL,CAAY,IAAZ;AACA,MAAO,KAAP;AACA,CAAC,IAAK,aAAL,CAAoB;AACrB,KAAKa,MAAL,CAAYiC,WAAZ;AACA,MAAO,KAAP;AACA,CAAC,IAAK,QAAL,CAAe,IAAK,MAAL,CAAa;AAC7B,GAAI,CAAC,KAAKjB,OAAN,EAAiB,CAAC,KAAKD,OAA3B,CAAoC;AACnC,KAAKgB,WAAL,CAAiB,yDAAjB;AACA,MAAO,KAAP;AACA;AACD,GAAI,KAAKf,OAAL,CAAakB,MAAb,IAAyB,KAAKlB,OAAL,CAAamB,OAAb,EAA7B,CAAqD;AACpD,KAAK9C,IAAL,CAAU,OAAV,CAAmB,IAAnB;AACA;AACD,KAAK2B,OAAL,CAAe,GAAIoB,CAAAA,mBAAJ,CAAwB,KAAKrB,OAA7B,CAAf;AACA,KAAK5B,MAAL,CAAY,IAAZ;AACA,MAAO,KAAP;AACA,CAAC,IAAK,MAAL,CAAa,IAAK,QAAL,CAAe,IAAK,MAAL,CAAa,IAAK,MAAL,CAAa,IAAK,OAAL,CAAc,IAAK,QAAL,CAAe;AACpF,GAAI,CAAC,KAAK6B,OAAV,CAAmB;AAClB,KAAKe,WAAL,CAAiB,yDAAjB;AACA,MAAO,KAAP;AACA;AACD,GAAMM,CAAAA,aAAa,CAAG,KAAKrB,OAAL,CAAasB,SAAb,CAAuBpB,IAAI,CAACK,KAAL,CAAWD,GAAG,GAAK,QAAR,CAAmB,CAAnB,CAAuB,CAAlC,CAAvB,CAAtB;AACA,GAAIe,aAAJ,CAAmB;AAClB,KAAKN,WAAL,CAAiB,SAAUM,aAAV,CAAjB;AACA,MAAO,KAAP;AACA;AACD,GAAI,KAAKrB,OAAL,CAAakB,MAAb,EAAJ,CAA2B,KAAK7C,IAAL,YAAqB,KAAK2B,OAAL,CAAauB,QAAb,EAArB,CAAgD,IAAhD;AAC3B,KAAKpD,MAAL,CAAY,IAAZ;AACA,MAAO,KAAP;AACA,CAnDD;AAoDA,2BAAa8B,aAAb,WAA2BC,IAA3B;AACA,C,qBA1EuBsB,Q;;;AA6EnBC,S;AACLC,qB,CAAA,gCAAwB;AACvB,MAAO,MAAP;AACA,C;AACDnC,M,CAAA,iBAAS;AACR,MAAO,iBAAK,QAAM,QAAX,EAAP;AACA,C,oBANsBoC,MAAM,CAACC,S;;;AAS/B,QAASC,CAAAA,UAAT,CAAoBpD,KAApB;;AAEG;AACF,MAAO,oBAAQ,IAAI,CAAC,KAAb,CAAmB,KAAK,CAAEA,KAAK,CAAC6B,GAAhC,CAAqC,gBAAe7B,KAAK,CAACqD,IAArB,eAArC,CAA8E,eAAcrD,KAAK,CAACsD,OAAlG;AACLtD,KAAK,CAACuD,QADD,CACU,mBADV;AAEN,kBAAO,QAAM,MAAb,EAAqBvD,KAAK,CAACqD,IAA3B,CAFM,KAEmC,kBAAO,QAAM,IAAb,EAAmBrD,KAAK,CAACwD,QAAN,CAAeC,EAAlC,KAAuCzD,KAAK,CAACwD,QAAN,CAAeE,KAAtD,CAFnC,QAAP;;AAIA;AACD,QAASC,CAAAA,aAAT,CAAuB3D,KAAvB;;AAEG;AACF,GAAM4D,CAAAA,OAAO,CAAG5D,KAAK,CAAC4D,OAAtB;AACA,GAAI,CAACA,OAAL,CAAc;AACb,MAAO;AACN,IAAI,CAAC,KADC,CACK,KAAK,CAAE5D,KAAK,CAAC6B,GADlB,CACuB,SAAU7B,KAAK,CAAC6D,QAAN,CAAiB,WAAjB,CAA+B,EAAzC,eADvB;AAEN,KAAK,CAAE,CAACC,OAAO,CAAE9D,KAAK,CAAC6D,QAAN,GAAmB,MAAnB,CAA4B,GAA5B,CAAkC,CAA5C,CAFD,CAEiD,eAAc7D,KAAK,CAACsD,OAFrE,iBAAP;;;;AAMA;;AAED,GAAIS,CAAAA,YAAJ;AACA,OAAQC,WAAW,CAACC,UAAZ,CAAuBL,OAAvB,CAAR;AACA,IAAK,GAAL,CAAUG,YAAY,CAAG,oBAAf,CAAqC;AAC/C,IAAK,GAAL,CAAUA,YAAY,CAAG,iBAAf,CAAkC;AAC5C,QAASA,YAAY,CAAG,OAAf,CAAwB,MAHjC;;;AAMA,MAAO;AACN,IAAI,CAAC,KADC,CACK,KAAK,CAAE/D,KAAK,CAAC6B,GADlB,CACuB,SAAU7B,KAAK,CAAC6D,QAAN,CAAiB,WAAjB,CAA+B,EAAzC,eADvB;AAEN,KAAK,CAAE,CAACC,OAAO,CAAE9D,KAAK,CAAC6D,QAAN,GAAmB,MAAnB,CAA4B,GAA5B,CAAkC,CAA5C,CAFD,CAEiD,eAAc7D,KAAK,CAACsD,OAFrE;;AAIN,iBAAM,QAAM,OAAZ,CAAoB,KAAK,CAAEvC,GAAG,CAACC,cAAJ,CAAmB4C,OAAnB,CAA3B,EAJM;AAKLA,OAAO,CAACM,IALH;;AAOL,CAAClE,KAAK,CAACmE,OAAP,EAAkB,CAACP,OAAO,CAACQ,OAA3B;AACA,iBAAM,QAAOL,YAAb;AACC,iBAAM,KAAK,CAAE,CAACM,KAAK,CAAEC,IAAI,CAACC,KAAL,CAAWX,OAAO,CAACY,EAAR,CAAa,EAAb,CAAkBZ,OAAO,CAACa,KAArC,GAA+C,CAAvD,CAAb,EADD,CARK;;;AAYL,CAACzE,KAAK,CAACmE,OAAP,EAAkBP,OAAO,CAACc,MAA1B,EAAoC,iBAAM,kBAAiBd,OAAO,CAACc,MAA/B,EAZ/B,CAAP;;AAcA,C;;AAEKC,W;AACL/E,I,CAAO,SAACgF,IAAD,CAAkB;AACxB,OAAK5E,KAAL,CAAWC,IAAX,CAAgBL,IAAhB,CAAqBgF,IAArB;AACA,C;;;;AAIDC,kB,CAAqB,UAAM;AAC1B,GAAMC,CAAAA,SAAS,CAAGC,MAAM,CAACC,YAAP,EAAlB;AACA,GAAIF,SAAS,CAACzB,IAAV,GAAmB,OAAvB,CAAgC;AAChC,OAAK4B,KAAL;AACA,C;AACDC,K,CAAQ,SAAC/E,CAAD,CAAsB;AAC7B,GAAIA,CAAC,CAACgF,OAAF,GAAc,EAAlB,CAAsB;AACrB,GAAMC,CAAAA,OAAO,CAAG,OAAKC,IAAL,CAAWC,sBAAX,CAAkC,UAAlC,EAA8C,CAA9C,CAAhB;AACAF,OAAO,CAACG,SAAR,CAAoBH,OAAO,CAACG,SAAR,CAAoBH,OAAO,CAACI,YAA5B,CAA2C,EAA/D;AACA,MAAO,KAAP;AACA,CAJD,IAIO,IAAIrF,CAAC,CAACgF,OAAF,GAAc,EAAlB,CAAsB;AAC5B,GAAMC,CAAAA,QAAO,CAAG,OAAKC,IAAL,CAAWC,sBAAX,CAAkC,UAAlC,EAA8C,CAA9C,CAAhB;AACAF,QAAO,CAACG,SAAR,CAAoBH,QAAO,CAACG,SAAR,CAAoBH,QAAO,CAACI,YAA5B,CAA2C,EAA/D;AACA,MAAO,KAAP;AACA;AACD,MAAO,MAAP;AACA,C;AACDC,iB,CAAoB,SAACtF,CAAD,CAAc;AACjC,GAAMuF,CAAAA,QAAQ,CAAGvF,CAAC,CAACwF,aAAnB;AACA,GAAMpE,CAAAA,OAAO,CAAG,OAAKvB,KAAL,CAAWC,IAAX,CAAgBsB,OAAhC;AACA,GAAI,CAACA,OAAL,CAAc;AACd,OAAQmE,QAAQ,CAACxB,IAAjB;AACA,IAAK,MAAL;AACC3C,OAAO,CAACqE,OAAR,CAAgBC,IAAhB,CAAuBH,QAAQ,CAACI,OAAhC;AACA;AACD,IAAK,OAAL;AACCvE,OAAO,CAACqE,OAAR,CAAgBG,KAAhB,CAAwBL,QAAQ,CAACI,OAAjC;AACA;AACD,IAAK,GAAL;AACCvE,OAAO,CAACqE,OAAR,CAAgBI,CAAhB,CAAoBN,QAAQ,CAACI,OAA7B;AACA;AACD,IAAK,KAAL;AACCvE,OAAO,CAACqE,OAAR,CAAgBK,GAAhB,CAAsBP,QAAQ,CAACI,OAA/B;AACA,MAZD;;AAcA,OAAK9F,KAAL,CAAWC,IAAX,CAAgBP,MAAhB,CAAuB,IAAvB;AACA,C,0DAvCDuF,K,CAAA,gBAAQ,CACP,KAAKI,IAAL,CAAWa,aAAX,CAAyB,UAAzB,EAAsCjB,KAAtC,GACA,C;AAsCDkB,iB,CAAA,4BAAoB;AACnB,GAAMC,CAAAA,KAAK,CAAGC,CAAC,CAAC,KAAKhB,IAAN,CAAf;AACA,GAAM9E,CAAAA,MAAM,CAAG,GAAI+F,CAAAA,MAAJ,CAAW;AACzBC,MAAM,CAAEH,KAAK,CAACI,IAAN,CAAW,SAAX,CADiB;AAEzBC,SAAS,CAAEL,KAAK,CAACI,IAAN,CAAW,aAAX,CAFc,CAAX,CAAf;;AAIA,KAAKxG,KAAL,CAAWC,IAAX,CAAgBM,MAAhB,CAAyBA,MAAzB;AACCA,MAAM,CAACmG,KAAR,CAA8BC,QAA9B,CAAuCC,MAAvC,CAA8CR,KAAK,CAACI,IAAN,CAAW,kBAAX,CAA9C;AACA,wBAAML,iBAAN;AACA5F,MAAM,CAACsG,SAAP,CAAiB,iBAAM,CAAA,MAAI,CAACC,WAAL,EAAN,EAAjB;AACA,C;AACDxE,W,CAAA,qBAAYyE,IAAZ,CAAwB;AACvB,GAAM9G,CAAAA,IAAI,CAAG,KAAKD,KAAL,CAAWC,IAAxB;AACA,OAAQ8G,IAAI,CAAC,CAAD,CAAZ;AACA,IAAK,UAAL;AACC9G,IAAI,CAACM,MAAL,CAAYgC,QAAZ,CAAqByE,QAArB;AACA;AACD,IAAK,SAAL;AACC,KAAKC,cAAL,CAAoBF,IAAI,CAAC,CAAD,CAAJ,CAAUG,IAAI,CAACC,KAAL,CAAWJ,IAAI,CAAC,CAAD,CAAf,CAAV,CAAgC,IAApD;AACA;AACD,IAAK,KAAL,CAAY,IAAK,KAAL;AACX,KAAKE,cAAL,CAAoB,IAApB;AACA;AACD,IAAK,GAAL,CAAU,IAAK,IAAL,CAAW,IAAK,MAAL,CAAa,IAAK,SAAL,CAAgB,IAAK,UAAL;AACjDhH,IAAI,CAACM,MAAL,CAAY6G,UAAZ,CAAuB,IAAML,IAAI,CAACM,IAAL,CAAU,GAAV,CAA7B;AACA;AACD,IAAK,OAAL;AACC,GAAIN,IAAI,CAAC,CAAD,CAAJ,CAAQrF,UAAR,CAAmB,kBAAnB,GAA0CzB,IAAI,CAACqB,OAAnD,CAA4D;AAC3DrB,IAAI,CAACsB,OAAL,CAAe,GAAIoB,CAAAA,mBAAJ,CAAwB1C,IAAI,CAACqB,OAA7B,CAAf;AACArB,IAAI,CAACP,MAAL,CAAY,IAAZ;AACA;AACD,MAlBD;;AAoBAO,IAAI,CAACM,MAAL,CAAY+G,GAAZ,CAAgB,IAAMP,IAAI,CAACM,IAAL,CAAU,GAAV,CAAtB;AACA,C;AACDJ,c,CAAA,wBAAe3F,OAAf,CAA8C;AAC7C,GAAMrB,CAAAA,IAAI,CAAG,KAAKD,KAAL,CAAWC,IAAxB;AACA,GAAI,CAACqB,OAAL,CAAc;AACbrB,IAAI,CAACqB,OAAL,CAAe,IAAf;AACArB,IAAI,CAACsB,OAAL,CAAe,IAAf;AACA;AACA;;AAEDoB,mBAAmB,CAAC4E,UAApB,CAA+BjG,OAA/B,CAAwCrB,IAAI,CAACM,MAA7C;;AAEA,GAAIe,OAAO,CAACD,IAAZ,CAAkB;AACjBpB,IAAI,CAACM,MAAL,CAAYiH,SAAZ,CAAwBlG,OAAO,CAACD,IAAR,CAAauC,OAArC;AACA,GAAI3D,IAAI,CAACM,MAAL,CAAYkH,aAAZ,GAA8B,CAAC,EAAEnG,OAAO,CAACD,IAAR,CAAab,EAAb,GAAoB,IAAtB,CAAnC,CAAgE;AAC/DP,IAAI,CAACM,MAAL,CAAYiC,WAAZ;AACA;AACDvC,IAAI,CAACoB,IAAL,CAAYC,OAAO,CAACD,IAApB;AACA;;AAEDpB,IAAI,CAACqB,OAAL,CAAeA,OAAf;AACArB,IAAI,CAACsB,OAAL,CAAe,GAAIoB,CAAAA,mBAAJ,CAAwBrB,OAAxB,CAAf;AACArB,IAAI,CAACP,MAAL,CAAY,IAAZ;AACA,C;AACDgI,c,CAAA,yBAAiB;AAChB,GAAMzH,CAAAA,IAAI,CAAG,KAAKD,KAAL,CAAWC,IAAxB;AACA,GAAI,CAACA,IAAI,CAACM,MAAV,CAAkB,MAAO,KAAP;AAClB,GAAIN,IAAI,CAACoB,IAAT,CAAe;AACd,MAAO,MAAKsG,oBAAL,EAAP;AACA;AACD,GAAMC,CAAAA,KAAK,CAAG3H,IAAI,CAACM,MAAL,CAAYsH,UAA1B;AACA,MAAO,iBAAK,QAAM,UAAX;AACN;AACED,KAAK;AACL,mBAAQ,QAAM,iBAAd,CAAgC,IAAI,CAAC,KAArC,CAA2C,KAAK,CAAC,OAAjD,EAAyD,cAAG,QAAM,YAAT,EAAzD,CAAmF,mBAAnF,QADK;AAEJ3H,IAAI,CAACM,MAAL,CAAYuH,MAAZ;AACD,mBAAQ,QAAM,QAAd,CAAuB,IAAI,CAAC,KAA5B,CAAkC,KAAK,CAAC,OAAxC,EAAgD,cAAG,QAAM,YAAT,EAAhD,CAA0E,mBAA1E,QADC;;AAGD,mBAAQ,QAAM,QAAd,CAAuB,IAAI,CAAC,KAA5B,CAAkC,KAAK,CAAC,QAAxC,EAAiD,cAAG,QAAM,aAAT,EAAjD,CAA4E,mBAA5E,SANF;;AAQC,mBAAQ,QAAM,QAAd,CAAuB,IAAI,CAAC,KAA5B,CAAkC,KAAK,CAAC,UAAxC,EAAmD,cAAG,QAAM,qBAAT,EAAnD,CAAsF,mBAAtF,aARD;AASC,mBAAQ,QAAO,UAAYF,KAAK,CAAG,WAAH,CAAiB,EAAlC,CAAf,CAAsD,IAAI,CAAC,KAA3D,CAAiE,KAAK,CAAC,UAAvE,EAAkF,cAAG,QAAM,oBAAT,EAAlF,CAAoH,mBAApH,aATD;AAUC,mBAAQ,QAAM,QAAd,CAAuB,IAAI,CAAC,KAA5B,CAAkC,KAAK,CAAC,SAAxC,EAAkD,cAAG,QAAM,YAAT,EAAlD,CAA4E,mBAA5E,cAVD;AAWC,mBAAQ,QAAO,UAAYA,KAAK,CAAG,WAAH,CAAiB,EAAlC,CAAf,CAAsD,IAAI,CAAC,KAA3D,CAAiE,KAAK,CAAC,WAAvE,EAAmF,cAAG,QAAM,oBAAT,EAAnF,CAAqH,mBAArH,eAXD,CADM;;AAcN;AACC,mBAAQ,QAAM,QAAd,CAAuB,IAAI,CAAC,KAA5B,CAAkC,KAAK,CAAC,cAAxC,EAAuD,cAAG,QAAM,cAAT,EAAvD,iBADD,CAdM,CAAP;;;AAkBA,C;AACDG,kB,CAAA,4BAAmBzG,OAAnB,CAA+CC,OAA/C,CAA6E;AAC5E,GAAMyG,CAAAA,GAAG,CAAG,KAAKhI,KAAL,CAAWC,IAAX,CAAgBM,MAAhB,CAAuByH,GAAnC;AACA,GAAMC,CAAAA,YAAY,CAAG1G,OAAO,CAAC2G,KAAR,EAArB;AACA,GAAMC,CAAAA,MAAM,CAAG5G,OAAO,CAAC6G,kBAAR,EAAf;AACA,GAAI,CAACD,MAAL,CAAa,MAAO,iBAAK,QAAM,eAAX,oBAAP;;AAEb,GAAI5G,OAAO,CAACqE,OAAR,CAAgBK,GAAhB,EAAwBkC,MAAM,CAACE,QAAP,EAAmB,CAACF,MAAM,CAACG,UAAvD,CAAoE;AACnE,GAAI,CAACH,MAAM,CAACE,QAAZ,CAAsB;AACrB,MAAO,iBAAK,QAAM,eAAX,4BAAP;AACA;AACD,MAAOF,CAAAA,MAAM,CAACI,KAAP,CAAarH,GAAb,CAAiB,SAACsC,QAAD,CAAWgF,CAAX,CAAiB;AACxC,GAAMC,CAAAA,IAAI,CAAGT,GAAG,CAACU,OAAJ,CAAYlF,QAAQ,CAACU,IAArB,CAAb;AACA,GAAMyE,CAAAA,WAAW,CAAGR,MAAM,CAACE,QAAP,CAAiBG,CAAjB,CAApB;AACA,GAAMI,CAAAA,WAAW,CAAGD,WAAW,CAACnI,EAAZ,CAAekB,UAAf,CAA0B,MAA1B,MAAwCiH,WAAW,CAACnI,EAApD,GAApB;AACA,GAAM8C,CAAAA,OAAO,YAAcE,QAAQ,CAACU,IAAvB,KAA+B+D,YAA/B,CAA8CW,WAA3D;AACA,MAAO,UAAC,UAAD,EAAY,GAAG,WAAWJ,CAAC,CAAG,CAAf,QAAf,CAAuC,IAAI,CAAEC,IAAI,CAACpF,IAAlD,CAAwD,OAAO,CAAEC,OAAjE,CAA0E,QAAQ,CAAEE,QAApF;AACLmF,WAAW,CAACzE,IADP,CAAP;;AAGA,CARM,CAAP;AASA;;AAED,GAAI3C,OAAO,CAACqE,OAAR,CAAgBI,CAApB,CAAuB;AACtB,GAAI,CAACmC,MAAM,CAACU,MAAZ,CAAoB;AACnB,MAAO,iBAAK,QAAM,eAAX,eAAP;AACA;AACD,MAAOV,CAAAA,MAAM,CAACI,KAAP,CAAarH,GAAb,CAAiB,SAACsC,QAAD,CAAWgF,CAAX,CAAiB;AACxC,GAAMC,CAAAA,IAAI,CAAGT,GAAG,CAACU,OAAJ,CAAYlF,QAAQ,CAACU,IAArB,CAAb;AACA,GAAM4E,CAAAA,SAAS,CAAGX,MAAM,CAACU,MAAP,CAAeL,CAAf,CAAlB;AACA,GAAI,CAACM,SAAL,CAAgB;AACf,MAAO,oBAAQ,QAAQ,KAAhB,SAAP;AACA;AACD,GAAMxF,CAAAA,OAAO,UAAYE,QAAQ,CAACU,IAArB,KAA6B+D,YAA1C;AACA,MAAO,UAAC,UAAD,EAAY,GAAG,WAAWO,CAAC,CAAG,CAAf,UAAf,CAAyC,IAAI,CAAEC,IAAI,CAACpF,IAApD,CAA0D,OAAO,CAAEC,OAAnE,CAA4E,QAAQ,CAAE,CAACG,EAAE,CAAE,CAAL,CAAQC,KAAK,CAAE,CAAf,CAAtF;AACLoF,SAAS,CAAC5E,IADL,CAAP;;AAGA,CAVM,CAAP;AAWA;;AAED,MAAOiE,CAAAA,MAAM,CAACI,KAAP,CAAarH,GAAb,CAAiB,SAACsC,QAAD,CAAWgF,CAAX,CAAiB;AACxC,GAAMC,CAAAA,IAAI,CAAGT,GAAG,CAACU,OAAJ,CAAYlF,QAAQ,CAACU,IAArB,CAAb;AACA,GAAMZ,CAAAA,OAAO,SAAWE,QAAQ,CAACU,IAApB,KAA4B+D,YAAzC;AACA,MAAO,UAAC,UAAD,EAAY,GAAG,WAAWO,CAAC,CAAG,CAAf,CAAf,CAAmC,IAAI,CAAEC,IAAI,CAACpF,IAA9C,CAAoD,OAAO,CAAEC,OAA7D,CAAsE,QAAQ,CAAEE,QAAhF;AACLiF,IAAI,CAACvE,IADA,CAAP;;AAGA,CANM,CAAP;AAOA,C;AACD6E,wB,CAAA,kCAAyBzH,OAAzB,CAAqDC,OAArD,CAAmF;AAClF,GAAMhB,CAAAA,MAAM,CAAG,KAAKP,KAAL,CAAWC,IAAX,CAAgBM,MAA/B;AACA,GAAMyI,CAAAA,UAAU,CAAGzH,OAAO,CAAC0H,aAAR,CAAsB1H,OAAO,CAACqE,OAA9B,CAAuCrE,OAAO,CAAC2G,KAAR,EAAvC,EAAwD7H,MAA3E;AACA,GAAM6I,CAAAA,UAAU,CAAG3H,OAAO,CAAC4H,YAAR,CAAqB5H,OAAO,CAACqE,OAA7B,CAAnB;;AAEA,GAAMwD,CAAAA,QAAQ,CAAG7H,OAAO,CAAC2G,KAAR,EAAjB;AACA,GAAMmB,CAAAA,aAAa,CAAG9I,MAAM,CAAC+I,OAAP,CAAenB,MAAf,CAAsBlH,MAAtB,CAA+B,CAA/B,CAAmCmI,QAAzD;;AAEA,MAAO;AACN7I,MAAM,CAAC+I,OAAP,CAAenB,MAAf,CAAsBjH,GAAtB,CAA0B,SAAC0C,OAAD,CAAU4E,CAAV,CAAgB;AACzC,GAAI3E,CAAAA,QAAQ,CAAG,KAAf;AACA,GAAImF,UAAU,GAAK,cAAf,EAAiCA,UAAU,GAAK,oBAApD,CAA0E;AACzEnF,QAAQ,CAAG,IAAX;AACA,CAFD,IAEO,IAAImF,UAAU,GAAK,QAAf,EAA2BA,UAAU,GAAK,aAA9C,CAA6D;AACnE,GAAI1E,IAAI,CAACiF,GAAL,CAASF,aAAa,CAAGb,CAAzB,EAA8B,CAAlC,CAAqC3E,QAAQ,CAAG,IAAX;AACrC;;AAED,aAAID,OAAJ,SAAI,SAASQ,OAAb,CAAsBR,OAAO,CAAG,IAAV;AACtB,MAAO,UAAC,aAAD;AACN,OAAO,CAAEA,OADH;AAEN,GAAG,CAAEC,QAAQ,QAAYqF,UAAZ,OAA2BV,CAAC,CAAG,CAA/B,CAFP,CAE2C,QAAQ,CAAE3E,QAAQ,EAAI,MAFjE,CAEyE,OAAO,oBAAqB2E,CAFrG,EAAP;;AAIA,CAbD,EAaGgB,OAbH,EADM;AAeN,gBAAK,KAAK,CAAC,aAAX,EAfM;AAgBNjJ,MAAM,CAACkJ,QAAP,CAAgBtB,MAAhB,CAAuBjH,GAAvB,CAA2B,SAAC0C,OAAD,CAAU4E,CAAV,CAAgB;AAC1C,GAAI3E,CAAAA,QAAQ,CAAG,KAAf;AACA,GAAImF,UAAU,GAAK,aAAnB,CAAkC;AACjCnF,QAAQ,CAAG,IAAX;AACA,CAFD,IAEO,IAAImF,UAAU,GAAK,QAAf,EAA2BA,UAAU,GAAK,cAA1C,EAA4DA,UAAU,GAAK,oBAA/E,CAAqG;AAC3G,GAAI1E,IAAI,CAACiF,GAAL,CAASH,QAAQ,CAAGZ,CAApB,EAAyB,CAA7B,CAAgC3E,QAAQ,CAAG,IAAX;AAChC;AACD,GAAImF,UAAU,GAAK,oBAAf,EAAuCI,QAAQ,GAAKZ,CAAxD,CAA2D3E,QAAQ,CAAG,IAAX;;AAE3D,cAAID,OAAJ,SAAI,UAASQ,OAAb,CAAsBR,OAAO,CAAG,IAAV;AACtB,MAAO,UAAC,aAAD;AACN,OAAO,CAAEA,OADH;AAEN,GAAG,CAAEC,QAAQ,QAAYqF,UAAZ,OAA2BV,CAAC,CAAG,CAA/B,CAFP,CAE2C,QAAQ,CAAE3E,QAAQ,EAAI,MAFjE,CAEyE,OAAO,oBAAqB2E,CAFrG,EAAP;;AAIA,CAdD,CAhBM,CAAP;;AAgCA,C;AACDkB,oB,CAAA,8BAAqBpI,OAArB,CAAuEC,OAAvE,CAAqG;AACpG,GAAMoI,CAAAA,SAAS,CAAGpI,OAAO,CAACqI,aAAR,EAAlB;;AAEA,GAAMC,CAAAA,OAAO,wBAAGtI,OAAO,CAAC6G,kBAAR,EAAH,eAAG,sBAA8ByB,OAA9C;;AAEA,MAAOvI,CAAAA,OAAO,CAACD,IAAR,CAAauC,OAAb,CAAqB1C,GAArB,CAAyB,SAAC4I,aAAD,CAAgBtB,CAAhB,CAAsB;AACrD,GAAMuB,CAAAA,UAAU,CAAGF,OAAO,EAAIrB,CAAC,CAAGmB,SAAf,EAA4BpI,OAAO,CAACyI,kBAAR,CAA2BC,QAA3B,CAAoCzB,CAAC,CAAG,CAAxC,CAA5B,EAA0EsB,aAAa,CAAC1F,OAA3G;AACA,MAAO,UAAC,aAAD;AACN,OAAO,CAAE0F,aADH,CACkB,GAAG,aAAatB,CAAC,CAAG,CAAjB,CADrB,CAC2C,QAAQ,CAAEuB,UADrD,CACiE,OAAO,kBAAmBvB,CAD3F,EAAP;;AAGA,CALM,CAAP;AAMA,C;AACD0B,kB,CAAA,4BAAmB5I,OAAnB,CAAiDC,OAAjD,CAA+E;AAC9E,MAAOD,CAAAA,OAAO,CAACD,IAAR,CAAauC,OAAb,CAAqB1C,GAArB,CAAyB,SAAC4I,aAAD,CAAgBtB,CAAhB,CAAsB;AACrD,GAAMuB,CAAAA,UAAU,CAAGxI,OAAO,CAACyI,kBAAR,CAA2BC,QAA3B,CAAoCzB,CAAC,CAAG,CAAxC,CAAnB;AACA,MAAO,UAAC,aAAD;AACN,OAAO,CAAEsB,aADH,CACkB,GAAG,aAAatB,CAAC,CAAG,CAAjB,CADrB,CAC2C,OAAO,KADlD,CACmD,QAAQ,CAAEuB,UAAU,EAAI,MAD3E,CACmF,OAAO,kBAAmBvB,CAD7G,EAAP;;AAGA,CALM,CAAP;AAMA,C;AACD2B,c,CAAA,yBAAiB;AAChB,GAAMC,CAAAA,IAAI,CAAG,KAAKpK,KAAL,CAAWC,IAAX,CAAgBM,MAAhB,CAAuBiH,SAApC;AACA,GAAI,CAAC4C,IAAL,CAAW;AACX,MAAO,iBAAK,QAAM,gBAAX;AACN,eAAI,QAAM,cAAV,SADM;AAEN,gBAAK,QAAM,YAAX;AACEA,IAAI,CAAClJ,GAAL,CAAS,SAAC4I,aAAD,CAAgBtB,CAAhB,CAAsB;AAC/B,MAAO,UAAC,aAAD;AACN,OAAO,CAAEsB,aADH,CACkB,GAAG,GADrB,CAC2B,OAAO,KADlC,CACmC,QAAQ,CAAE,IAD7C,CACmD,OAAO,kBAAmBtB,CAD7E,EAAP;;AAGA,CAJA,CADF,CAFM,CAAP;;;AAUA,C;AACD6B,gB,CAAA,0BAAiB/I,OAAjB,CAA6CC,OAA7C,CAA2E;AAC1E,MAAOA,CAAAA,OAAO,CAACyI,kBAAR,CAA2B9I,GAA3B,CAA+B,SAAAoJ,IAAI,CAAI;AAC7C,GAAMR,CAAAA,aAAa,CAAGxI,OAAO,CAACD,IAAR,CAAauC,OAAb,CAAqB0G,IAAI,CAAG,CAA5B,CAAtB;AACA,MAAO,UAAC,aAAD;AACN,OAAO,CAAER,aADH,CACkB,GAAG,YAAaQ,IADlC,CAC0C,QAAQ,KADlD,CACmD,OAAO,mBAAmBA,IAAI,CAAG,CAA1B,CAD1D,EAAP;;AAGA,CALM,CAAP;AAMA,C;AACDC,gB,CAAA,0BAAiBjJ,OAAjB,CAAyCC,OAAzC,CAAuE;AACtE,GAAI,CAACA,OAAL,CAAc,MAAO,KAAP;AACd,GAAID,OAAO,CAACkJ,WAAR,GAAwB,MAAxB,EAAkClJ,OAAO,CAACkJ,WAAR,GAAwB,QAA9D,CAAwE;AACxE,GAAIjJ,OAAO,CAACmB,OAAR,EAAJ,CAAuB,MAAO,KAAP;;AAEvB,GAAI+H,CAAAA,GAA4B,CAAG;AAClC,mBAAQ,IAAI,CAAC,KAAb,CAAmB,KAAK,CAAC,SAAzB,CAAmC,QAAM,QAAzC,EAAkD,cAAG,QAAM,oBAAT,EAAlD,SADkC,CACkE,GADlE,CAAnC;;AAGA,GAAIlJ,OAAO,CAACkB,MAAR,IAAoBnB,OAAO,CAACoJ,QAAhC,CAA0C;AACzCD,GAAG,CAAG,CAAC,yBAAD,CAAN;AACA;;AAED,GAAMlK,CAAAA,MAAM,CAAG,KAAKP,KAAL,CAAWC,IAAX,CAAgBM,MAA/B;AACA,IAAK,GAAIiI,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGjH,OAAO,CAACA,OAAR,CAAgBN,MAApC,CAA4CuH,CAAC,EAA7C,CAAiD;AAChD,GAAMmC,CAAAA,YAAY,CAAGpJ,OAAO,CAACA,OAAR,CAAgBiH,CAAhB,CAArB;AACA,GAAMoC,CAAAA,MAAM,CAAGrJ,OAAO,CAACsJ,WAAR,CAAoBF,YAApB,CAAf;AACA,GAAI,CAACC,MAAL,CAAa;AACb,GAAMhH,CAAAA,OAAO,CAAGtC,OAAO,CAACD,IAAR,CAAauC,OAAb,CAAqB4E,CAArB,CAAhB;AACA,GAAML,CAAAA,MAAM,CAAG7G,OAAO,CAACkJ,WAAR,GAAwB,MAAxB,CAAiClJ,OAAO,CAAC6G,MAAR,CAAeK,CAAf,CAAjC,CAAqD,IAApE;AACA,GAAIoC,MAAM,CAACE,UAAP,GAAsB,MAA1B,CAAkC;AACjCL,GAAG,CAACM,IAAJ,CAAYnH,OAAO,CAACM,IAApB;AACA,GAAI0G,MAAM,CAAC/E,IAAX,CAAiB4E,GAAG,CAACM,IAAJ;AACjB,GAAIH,MAAM,CAAC7E,KAAX,CAAkB0E,GAAG,CAACM,IAAJ;AAClB,GAAIH,MAAM,CAAC3E,GAAP,EAAckC,MAAd,QAAcA,MAAM,CAAEG,UAA1B,CAAsCmC,GAAG,CAACM,IAAJ,CAAS5C,MAAM,MAAN,EAAAA,MAAM,CAAE6C,aAAR,iCAAT;AACtCP,GAAG,CAACM,IAAJ,QAAiB,uBAASxJ,OAAO,CAAC0H,aAAR,CAAsB2B,MAAtB,CAA8BpC,CAA9B,EAAiCtE,IAA1C,CAAjB;AACA,GAAI0G,MAAM,CAACK,SAAP,CAAmB,CAAvB,CAA0B;AACzB,GAAM5K,CAAAA,MAAM,CAAGE,MAAM,CAAC+I,OAAP,CAAenB,MAAf,CAAsByC,MAAM,CAACK,SAAP,CAAmB,CAAzC,CAAf;AACA,GAAI,CAAC5K,MAAL,CAAa;AACZoK,GAAG,CAACM,IAAJ,aAAqBH,MAAM,CAACK,SAA5B;AACA,CAFD,IAEO;AACNR,GAAG,CAACM,IAAJ,QAAgB1K,MAAM,CAAC6D,IAAvB;AACA;AACD,CAPD,IAOO,IAAI0G,MAAM,CAACK,SAAP,CAAmB,CAAvB,CAA0B;AAChC,GAAM5K,CAAAA,OAAM,CAAGE,MAAM,CAACkJ,QAAP,CAAgBtB,MAAhB,CAAuB,CAACyC,MAAM,CAACK,SAAR,CAAoB,CAA3C,CAAf;AACA,GAAI,CAAC5K,OAAL,CAAa;AACZoK,GAAG,CAACM,IAAJ,kBAA0BH,MAAM,CAACK,SAAjC;AACA,CAFD,IAEO;AACNR,GAAG,CAACM,IAAJ,aAAqB1K,OAAM,CAAC6D,IAA5B;AACA;AACD;AACD,CArBD,IAqBO,IAAI0G,MAAM,CAACE,UAAP,GAAsB,QAA1B,CAAoC;AAC1C,GAAMzK,CAAAA,QAAM,CAAGiB,OAAO,CAACD,IAAR,CAAauC,OAAb,CAAqBgH,MAAM,CAACM,aAAP,CAAuB,CAA5C,CAAf;AACAT,GAAG,CAACM,IAAJ,CAAYnH,OAAO,CAACM,IAApB,oBAA4C,uBAAS7D,QAAM,CAAC6D,IAAhB,CAA5C;AACA,CAHM,IAGA,IAAI0G,MAAM,CAACE,UAAP,GAAsB,OAA1B,CAAmC;AACzCL,GAAG,CAACM,IAAJ,CAAYnH,OAAO,CAACM,IAApB,UAAkC,+BAAlC;AACA;AACDuG,GAAG,CAACM,IAAJ,CAAS,mBAAT;AACA;AACD,MAAON,CAAAA,GAAP;AACA,C;AACD9C,oB,CAAA,+BAAuB;AACtB,GAAM1H,CAAAA,IAAI,CAAG,KAAKD,KAAL,CAAWC,IAAxB;AACA,GAAMqB,CAAAA,OAAO,CAAGrB,IAAI,CAACqB,OAArB;AACA,GAAIC,CAAAA,OAAO,CAAGtB,IAAI,CAACsB,OAAnB;AACA,GAAI,CAACD,OAAL,CAAc,MAAO,wBAAP;AACd,GAAI,CAACC,OAAL,CAAc,MAAO,oCAAP;AACd,GAAIA,OAAO,CAACD,OAAR,GAAoBA,OAAxB,CAAiC;AAChCC,OAAO,CAAG,GAAIoB,CAAAA,mBAAJ,CAAwBrB,OAAxB,CAAV;AACArB,IAAI,CAACsB,OAAL,CAAeA,OAAf;AACA;;AAED,GAAIA,OAAO,CAACkB,MAAR,EAAJ,CAAsB;AACrB,MAAO,iBAAK,QAAM,UAAX;AACN,gBAAK,QAAM,QAAX;AACC,mBAAQ,IAAI,CAAC,WAAb,CAAyB,QAAM,6BAA/B,EAA6D,cAAG,QAAM,uBAAT,EAA7D,UADD;AAEE,KAAK8H,gBAAL,CAAsBjJ,OAAtB,CAA+BC,OAA/B,CAFF,CADM;;AAKN,gBAAK,QAAM,KAAX;AACED,OAAO,CAACoJ,QAAR,CAAmB,IAAnB,CAA0B,mBAAQ,IAAI,CAAC,KAAb,CAAmB,KAAK,CAAC,SAAzB,CAAmC,QAAM,QAAzC,WAD5B,CALM;;AAQL,KAAKP,cAAL,EARK,CAAP;;AAUA;AACD,GAAI7I,OAAO,CAACD,IAAZ,CAAkBpB,IAAI,CAACM,MAAL,CAAYiH,SAAZ,CAAwBlG,OAAO,CAACD,IAAR,CAAauC,OAArC;AAClB,OAAQtC,OAAO,CAACkJ,WAAhB;AACA,IAAK,MAAL,CAAa;AACZ,GAAMtC,CAAAA,KAAK,CAAG3G,OAAO,CAAC2G,KAAR,EAAd;AACA,GAAMtE,CAAAA,OAAO,CAAGtC,OAAO,CAACD,IAAR,CAAauC,OAAb,CAAqBsE,KAArB,CAAhB;AACA,GAAMiD,CAAAA,WAAW,CAAG5J,OAAO,CAAC6G,kBAAR,EAApB;;AAEA,GAAME,CAAAA,UAAU,CAAG6C,WAAW,CAAC7C,UAAZ,EAA0B,CAAC/G,OAAO,CAAC6J,UAAtD;AACA,GAAMC,CAAAA,UAAU,CAAGF,WAAW,CAACE,UAAZ,EAA0B,CAAC9J,OAAO,CAAC+J,WAAtD;AACA,GAAMC,CAAAA,QAAQ,CAAGJ,WAAW,CAACtC,MAAZ,EAAsB,CAACtH,OAAO,CAACiK,QAAhD;;AAEA,GAAIjK,OAAO,CAACqE,OAAR,CAAgB6C,IAApB,CAA0B;AACzB,GAAMgD,CAAAA,QAAQ,CAAGlK,OAAO,CAAC0H,aAAR,CAAsB1H,OAAO,CAACqE,OAA9B,CAAuCrE,OAAO,CAAC2G,KAAR,EAAvC,EAAwDhE,IAAzE;AACA,MAAO,iBAAK,QAAM,UAAX;AACN,gBAAK,QAAM,QAAX;AACC,mBAAQ,IAAI,CAAC,WAAb,CAAyB,QAAM,6BAA/B,EAA6D,cAAG,QAAM,uBAAT,EAA7D,UADD;AAEE,KAAKqG,gBAAL,CAAsBjJ,OAAtB,CAA+BC,OAA/B,CAFF;AAGEqC,OAAO,CAACM,IAHV,gBAG2B,uBAASuH,QAAT,CAH3B,eADM;;AAMN,gBAAK,QAAM,gBAAX;AACC,gBAAK,QAAM,YAAX;AACE,KAAK1C,wBAAL,CAA8BzH,OAA9B,CAAuCC,OAAvC,CADF,CADD,CANM,CAAP;;;;AAYA;;AAED,GAAMmK,CAAAA,QAAQ,CAAGzL,IAAI,CAACM,MAAL,CAAYoL,QAAZ,GAAyB,SAAzB,EAAsCzD,KAAK,GAAK,CAAjE;;AAEA,MAAO,iBAAK,QAAM,UAAX;AACN,gBAAK,QAAM,QAAX;AACC,mBAAQ,IAAI,CAAC,WAAb,CAAyB,QAAM,6BAA/B,EAA6D,cAAG,QAAM,uBAAT,EAA7D,UADD;AAEE,KAAKqC,gBAAL,CAAsBjJ,OAAtB,CAA+BC,OAA/B,CAFF;AAGW,uBAASqC,OAAO,CAACM,IAAjB,CAHX,QADM;;AAMN,gBAAK,QAAM,cAAX;AACC,eAAI,QAAM,YAAV,WADD;AAEC,gBAAK,QAAM,UAAX;AACE,KAAK6D,kBAAL,CAAwBzG,OAAxB,CAAiCC,OAAjC,CADF;AAEC,gBAAK,KAAK,CAAC,YAAX,EAFD;AAGE+G,UAAU,EAAI,kBAAO,mBAAiB/G,OAAO,CAACqE,OAAR,CAAgBK,GAAhB,CAAsB,MAAtB,CAA+B,EAAhD,CAAP;AACd,kBAAO,IAAI,CAAC,UAAZ,CAAuB,IAAI,CAAC,KAA5B,CAAkC,OAAO,CAAE1E,OAAO,CAACqE,OAAR,CAAgBK,GAA3D,CAAgE,QAAQ,CAAE,KAAKR,iBAA/E,EADc;AAEb0F,WAAW,CAACH,aAAZ,CAA4B,YAA5B,CAA2C,SAF9B,CAHhB;;AAOEK,UAAU,EAAI,kBAAO,mBAAiB9J,OAAO,CAACqE,OAAR,CAAgBC,IAAhB,CAAuB,MAAvB,CAAgC,EAAjD,CAAP;AACd,kBAAO,IAAI,CAAC,UAAZ,CAAuB,IAAI,CAAC,MAA5B,CAAmC,OAAO,CAAEtE,OAAO,CAACqE,OAAR,CAAgBC,IAA5D,CAAkE,QAAQ,CAAE,KAAKJ,iBAAjF,EADc,sBAPhB;;;AAWE0F,WAAW,CAACS,aAAZ,EAA6B,kBAAO,mBAAiBrK,OAAO,CAACqE,OAAR,CAAgBG,KAAhB,CAAwB,MAAxB,CAAiC,EAAlD,CAAP;AAC7B,kBAAO,IAAI,CAAC,UAAZ,CAAuB,IAAI,CAAC,OAA5B,CAAoC,OAAO,CAAExE,OAAO,CAACqE,OAAR,CAAgBG,KAA7D,CAAoE,QAAQ,CAAE,KAAKN,iBAAnF,EAD6B,mBAX/B;;;AAeE8F,QAAQ,EAAI,kBAAO,mBAAiBhK,OAAO,CAACqE,OAAR,CAAgBI,CAAhB,CAAoB,MAApB,CAA6B,EAA9C,CAAP;AACZ,kBAAO,IAAI,CAAC,UAAZ,CAAuB,IAAI,CAAC,GAA5B,CAAgC,OAAO,CAAEzE,OAAO,CAACqE,OAAR,CAAgBI,CAAzD,CAA4D,QAAQ,CAAE,KAAKP,iBAA3E,EADY,eAfd,CAFD,CANM;;;;;AA6BN,gBAAK,QAAM,gBAAX;AACEiG,QAAQ,EAAI;AACZ,eAAI,QAAM,aAAV,UADY;AAEZ,mBAAQ,IAAI,CAAC,KAAb,CAAmB,KAAK,CAAC,QAAzB,mBAFY,CADd;;AAKC,eAAI,QAAM,cAAV,WALD;AAMC,gBAAK,QAAM,YAAX;AACE,KAAKhC,oBAAL,CAA0BpI,OAA1B,CAAmCC,OAAnC,CADF,CAND,CA7BM,CAAP;;;;AAwCA,CAAC,IAAK,QAAL,CAAe;AAChB,GAAMqC,CAAAA,SAAO,CAAGtC,OAAO,CAACD,IAAR,CAAauC,OAAb,CAAqBrC,OAAO,CAAC2G,KAAR,EAArB,CAAhB;AACA,MAAO,iBAAK,QAAM,UAAX;AACN,gBAAK,QAAM,QAAX;AACC,mBAAQ,IAAI,CAAC,WAAb,CAAyB,QAAM,6BAA/B,EAA6D,cAAG,QAAM,uBAAT,EAA7D,UADD;AAEE,KAAKqC,gBAAL,CAAsBjJ,OAAtB,CAA+BC,OAA/B,CAFF;AAGW,uBAASqC,SAAO,CAACM,IAAjB,CAHX,QADM;;AAMN,gBAAK,QAAM,gBAAX;AACC,eAAI,QAAM,cAAV,WADD;AAEC,gBAAK,QAAM,YAAX;AACE,KAAKwF,oBAAL,CAA0BpI,OAA1B,CAAmCC,OAAnC,CADF,CAFD,CANM,CAAP;;;;AAaA,CAAC,IAAK,MAAL,CAAa;AACd,MAAO,iBAAK,QAAM,UAAX;AACN,gBAAK,QAAM,QAAX;AACC,mBAAQ,IAAI,CAAC,WAAb,CAAyB,QAAM,6BAA/B,EAA6D,cAAG,QAAM,uBAAT,EAA7D,UADD;AAEEA,OAAO,CAACyI,kBAAR,CAA2B/I,MAA3B,CAAoC,CAApC;AACA,CAAC,mBAAQ,IAAI,CAAC,KAAb,CAAmB,KAAK,CAAC,SAAzB,CAAmC,QAAM,QAAzC,EAAkD,cAAG,QAAM,oBAAT,EAAlD,SAAD;AACA,qCADA,CADA;;AAIA,iCANF,CADM;;;AAUN,gBAAK,QAAM,gBAAX;AACC,eAAI,QAAM,cAAV,YAAiCM,OAAO,CAACyI,kBAAR,CAA2B/I,MAA3B,EAAqC,CAArC,iBAA0DM,OAAO,CAACyI,kBAAR,CAA2B/I,MAA3B,CAAoC,CAA9F,CAAjC,CADD;AAEC,gBAAK,QAAM,YAAX;AACE,KAAKiJ,kBAAL,CAAwB5I,OAAxB,CAAiCC,OAAjC,CADF;AAEC,gBAAK,KAAK,CAAC,YAAX,EAFD,CAFD,CAVM;;;AAiBN,gBAAK,QAAM,gBAAX;AACEA,OAAO,CAACyI,kBAAR,CAA2B/I,MAA3B,CAAoC,CAApC,EAAyC,eAAI,QAAM,cAAV,gBAD3C;AAEC,gBAAK,QAAM,YAAX;AACE,KAAKoJ,gBAAL,CAAsB/I,OAAtB,CAA+BC,OAA/B,CADF,CAFD,CAjBM,CAAP;;;;AAwBA,CA5GD;AA6GA,C;AACDT,M,CAAA,iBAAS;AACR,GAAMb,CAAAA,IAAI,CAAG,KAAKD,KAAL,CAAWC,IAAxB;;AAEA,MAAO,UAAC,cAAD,EAAgB,IAAI,CAAEA,IAAtB;AACN,SAAC,SAAD,MADM;AAEN,SAAC,OAAD,EAAS,QAAM,wBAAf,CAAwC,IAAI,CAAE,KAAKD,KAAL,CAAWC,IAAzD,CAA+D,OAAO,CAAE,KAAK4E,kBAA7E,CAAiG,IAAI,CAAE,GAAvG,CAA4G,cAAc,KAA1H,EAFM;;;AAKN,SAAC,aAAD,EAAe,IAAI,CAAE,KAAK7E,KAAL,CAAWC,IAAhC,CAAsC,SAAS,CAAE,KAAKL,IAAtD,CAA4D,KAAK,CAAE,KAAKsF,KAAxE,CAA+E,IAAI,CAAE,GAArF,EALM;AAMN,SAAC,YAAD,EAAc,IAAI,CAAE,KAAKlF,KAAL,CAAWC,IAA/B,CAAqC,IAAI,CAAE,GAA3C,CAAgD,SAAS,KAAzD,EANM;AAON,gBAAK,QAAM,iBAAX,CAA6B,IAAI,CAAC,eAAlC,CAAkD,aAAW,iBAA7D,CAA+E,KAAK,CAAC,aAArF;AACE,KAAKyH,cAAL,EADF,CAPM,CAAP;;;AAWA,C,sBAtcwBvG,W;;;AAyc1BxB,EAAE,CAACkM,SAAH,CAAa,QAAb,EAAyB;AACxBC,KAAK,CAAE1K,UADiB;AAExB+B,SAAS,CAAEwB,WAFa,CAAzB;;AAIAhF,EAAE,CAACkM,SAAH,CAAa,SAAb,EAA0B;AACzBC,KAAK,CAAE3M,WADkB;AAEzBgE,SAAS,CAAEpD,YAFc,CAA1B;;AAIAJ,EAAE,CAACoM,eAAH","sourcesContent":["/**\n * Battle panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\ntype BattleDesc = {\n\tid: RoomID,\n\tminElo?: number | string,\n\tp1?: string,\n\tp2?: string,\n};\n\nclass BattlesRoom extends PSRoom {\n\treadonly classType = 'battles';\n\t/** null means still loading */\n\tformat = '';\n\tbattles: BattleDesc[] | null = null;\n\tconstructor(options: RoomOptions) {\n\t\tsuper(options);\n\t\tthis.refresh();\n\t}\n\tsetFormat(format: string) {\n\t\tif (format === this.format) return this.refresh();\n\t\tthis.battles = null;\n\t\tthis.format = format;\n\t\tthis.update(null);\n\t\tthis.refresh();\n\t}\n\trefresh() {\n\t\tPS.send(`|/cmd roomlist ${toID(this.format)}`);\n\t}\n}\n\nclass BattlesPanel extends PSRoomPanel<BattlesRoom> {\n\trefresh = () => {\n\t\tthis.props.room.refresh();\n\t};\n\tchangeFormat = (e: Event) => {\n\t\tconst value = (e.target as HTMLButtonElement).value;\n\t\tthis.props.room.setFormat(value);\n\t};\n\trenderBattleLink(battle: BattleDesc) {\n\t\tconst format = battle.id.split('-')[1];\n\t\tconst minEloMessage = typeof battle.minElo === 'number' ? `rated ${battle.minElo}` : battle.minElo;\n\t\treturn <div><a href={`/${battle.id}`} class=\"blocklink\">\n\t\t\t{minEloMessage && <small style=\"float:right\">({minEloMessage})</small>}\n\t\t\t<small>[{format}]</small><br />\n\t\t\t<em class=\"p1\">{battle.p1}</em> <small class=\"vs\">vs.</small> <em class=\"p2\">{battle.p2}</em>\n\t\t</a></div>;\n\t}\n\trender() {\n\t\tconst room = this.props.room;\n\t\treturn <PSPanelWrapper room={room} scrollable><div class=\"pad\">\n\t\t\t<button class=\"button\" style=\"float:right;font-size:10pt;margin-top:3px\" name=\"close\"><i class=\"fa fa-times\"></i> Close</button>\n\t\t\t<div class=\"roomlist\">\n\t\t\t\t<p>\n\t\t\t\t\t<button class=\"button\" name=\"refresh\" onClick={this.refresh}><i class=\"fa fa-refresh\"></i> Refresh</button> <span style={Dex.getPokemonIcon('meloetta-pirouette') + ';display:inline-block;vertical-align:middle'} class=\"picon\" title=\"Meloetta is PS's mascot! The Pirouette forme is Fighting-type, and represents our battles.\"></span>\n\t\t\t\t</p>\n\n\t\t\t\t<p>\n\t\t\t\t\t<label class=\"label\">Format:</label><FormatDropdown onChange={this.changeFormat} />\n\t\t\t\t</p>\n\t\t\t\t{/* <label>Minimum Elo: <select name=\"elofilter\"><option value=\"none\">None</option><option value=\"1100\">1100</option><option value=\"1300\">1300</option><option value=\"1500\">1500</option><option value=\"1700\">1700</option><option value=\"1900\">1900</option></select></label>\n\n\t\t\t\t<form class=\"search\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<input type=\"text\" name=\"prefixsearch\" class=\"textbox\" placeholder=\"Username prefix\"/><button type=\"submit\" class=\"button\">Search</button>\n\t\t\t\t\t</p>\n\t\t\t\t</form> */}\n\t\t\t\t<div class=\"list\">{!room.battles ?\n\t\t\t\t\t<p>Loading...</p>\n\t\t\t\t: !room.battles.length ?\n\t\t\t\t\t<p>No battles are going on</p>\n\t\t\t\t:\n\t\t\t\t\troom.battles.map(battle => this.renderBattleLink(battle))\n\t\t\t\t}</div>\n\t\t\t</div>\n\t\t</div></PSPanelWrapper>;\n\t}\n}\n\nclass BattleRoom extends ChatRoom {\n\treadonly classType = 'battle';\n\tpmTarget!: null;\n\tchallengeMenuOpen!: false;\n\tchallengingFormat!: null;\n\tchallengedFormat!: null;\n\n\tbattle: Battle = null!;\n\t/** null if spectator, otherwise current player's info */\n\tside: BattleRequestSideInfo | null = null;\n\trequest: BattleRequest | null = null;\n\tchoices: BattleChoiceBuilder | null = null;\n\n\t/**\n\t * @return true to prevent line from being sent to server\n\t */\n\thandleMessage(line: string) {\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\n\t\tconst spaceIndex = line.indexOf(' ');\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\n\t\tswitch (cmd) {\n\t\tcase 'play': {\n\t\t\tthis.battle.play();\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'pause': {\n\t\t\tthis.battle.pause();\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'ffto': case 'fastfowardto': {\n\t\t\tlet turnNum = Number(target);\n\t\t\tif (target.charAt(0) === '+' || turnNum < 0) {\n\t\t\t\tturnNum += this.battle.turn;\n\t\t\t\tif (turnNum < 0) turnNum = 0;\n\t\t\t} else if (target === 'end') {\n\t\t\t\tturnNum = -1;\n\t\t\t}\n\t\t\tif (isNaN(turnNum)) {\n\t\t\t\tthis.receiveLine([`error`, `/ffto - Invalid turn number: ${target}`]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis.battle.seekTurn(turnNum);\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'switchsides': {\n\t\t\tthis.battle.switchSides();\n\t\t\treturn true;\n\t\t} case 'cancel': case 'undo': {\n\t\t\tif (!this.choices || !this.request) {\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.choices.isDone() || this.choices.isEmpty()) {\n\t\t\t\tthis.send('/undo', true);\n\t\t\t}\n\t\t\tthis.choices = new BattleChoiceBuilder(this.request);\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'move': case 'switch': case 'team': case 'pass': case 'shift': case 'choose': {\n\t\t\tif (!this.choices) {\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst possibleError = this.choices.addChoice(line.slice(cmd === 'choose' ? 8 : 1));\n\t\t\tif (possibleError) {\n\t\t\t\tthis.receiveLine([`error`, possibleError]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.choices.isDone()) this.send(`/choose ${this.choices.toString()}`, true);\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t}}\n\t\treturn super.handleMessage(line);\n\t}\n}\n\nclass BattleDiv extends preact.Component {\n\tshouldComponentUpdate() {\n\t\treturn false;\n\t}\n\trender() {\n\t\treturn <div class=\"battle\"></div>;\n\t}\n}\n\nfunction MoveButton(props: {\n\tchildren: string, cmd: string, moveData: {pp: number, maxpp: number}, type: TypeName, tooltip: string,\n}) {\n\treturn <button name=\"cmd\" value={props.cmd} class={`type-${props.type} has-tooltip`} data-tooltip={props.tooltip}>\n\t\t{props.children}<br />\n\t\t<small class=\"type\">{props.type}</small> <small class=\"pp\">{props.moveData.pp}/{props.moveData.maxpp}</small>&nbsp;\n\t</button>;\n}\nfunction PokemonButton(props: {\n\tpokemon: Pokemon | ServerPokemon | null, cmd: string, noHPBar?: boolean, disabled?: boolean | 'fade', tooltip: string,\n}) {\n\tconst pokemon = props.pokemon;\n\tif (!pokemon) {\n\t\treturn <button\n\t\t\tname=\"cmd\" value={props.cmd} class={`${props.disabled ? 'disabled ' : ''}has-tooltip`}\n\t\t\tstyle={{opacity: props.disabled === 'fade' ? 0.5 : 1}} data-tooltip={props.tooltip}\n\t\t>\n\t\t\t(empty slot)\n\t\t</button>;\n\t}\n\n\tlet hpColorClass;\n\tswitch (BattleScene.getHPColor(pokemon)) {\n\tcase 'y': hpColorClass = 'hpbar hpbar-yellow'; break;\n\tcase 'r': hpColorClass = 'hpbar hpbar-red'; break;\n\tdefault: hpColorClass = 'hpbar'; break;\n\t}\n\n\treturn <button\n\t\tname=\"cmd\" value={props.cmd} class={`${props.disabled ? 'disabled ' : ''}has-tooltip`}\n\t\tstyle={{opacity: props.disabled === 'fade' ? 0.5 : 1}} data-tooltip={props.tooltip}\n\t>\n\t\t<span class=\"picon\" style={Dex.getPokemonIcon(pokemon)}></span>\n\t\t{pokemon.name}\n\t\t{\n\t\t\t!props.noHPBar && !pokemon.fainted &&\n\t\t\t<span class={hpColorClass}>\n\t\t\t\t<span style={{width: Math.round(pokemon.hp * 92 / pokemon.maxhp) || 1}}></span>\n\t\t\t</span>\n\t\t}\n\t\t{!props.noHPBar && pokemon.status && <span class={`status ${pokemon.status}`}></span>}\n\t</button>;\n}\n\nclass BattlePanel extends PSRoomPanel<BattleRoom> {\n\tsend = (text: string) => {\n\t\tthis.props.room.send(text);\n\t};\n\tfocus() {\n\t\tthis.base!.querySelector('textarea')!.focus();\n\t}\n\tfocusIfNoSelection = () => {\n\t\tconst selection = window.getSelection()!;\n\t\tif (selection.type === 'Range') return;\n\t\tthis.focus();\n\t};\n\tonKey = (e: KeyboardEvent) => {\n\t\tif (e.keyCode === 33) { // Pg Up key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\n\t\t\treturn true;\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\ttoggleBoostedMove = (e: Event) => {\n\t\tconst checkbox = e.currentTarget as HTMLInputElement;\n\t\tconst choices = this.props.room.choices;\n\t\tif (!choices) return; // shouldn't happen\n\t\tswitch (checkbox.name) {\n\t\tcase 'mega':\n\t\t\tchoices.current.mega = checkbox.checked;\n\t\t\tbreak;\n\t\tcase 'ultra':\n\t\t\tchoices.current.ultra = checkbox.checked;\n\t\t\tbreak;\n\t\tcase 'z':\n\t\t\tchoices.current.z = checkbox.checked;\n\t\t\tbreak;\n\t\tcase 'max':\n\t\t\tchoices.current.max = checkbox.checked;\n\t\t\tbreak;\n\t\t}\n\t\tthis.props.room.update(null);\n\t};\n\tcomponentDidMount() {\n\t\tconst $elem = $(this.base!);\n\t\tconst battle = new Battle({\n\t\t\t$frame: $elem.find('.battle'),\n\t\t\t$logFrame: $elem.find('.battle-log'),\n\t\t});\n\t\tthis.props.room.battle = battle;\n\t\t(battle.scene as BattleScene).tooltips.listen($elem.find('.battle-controls'));\n\t\tsuper.componentDidMount();\n\t\tbattle.subscribe(() => this.forceUpdate());\n\t}\n\treceiveLine(args: Args) {\n\t\tconst room = this.props.room;\n\t\tswitch (args[0]) {\n\t\tcase 'initdone':\n\t\t\troom.battle.seekTurn(Infinity);\n\t\t\treturn;\n\t\tcase 'request':\n\t\t\tthis.receiveRequest(args[1] ? JSON.parse(args[1]) : null);\n\t\t\treturn;\n\t\tcase 'win': case 'tie':\n\t\t\tthis.receiveRequest(null);\n\t\t\tbreak;\n\t\tcase 'c': case 'c:': case 'chat': case 'chatmsg': case 'inactive':\n\t\t\troom.battle.instantAdd('|' + args.join('|'));\n\t\t\treturn;\n\t\tcase 'error':\n\t\t\tif (args[1].startsWith('[Invalid choice]') && room.request) {\n\t\t\t\troom.choices = new BattleChoiceBuilder(room.request);\n\t\t\t\troom.update(null);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\troom.battle.add('|' + args.join('|'));\n\t}\n\treceiveRequest(request: BattleRequest | null) {\n\t\tconst room = this.props.room;\n\t\tif (!request) {\n\t\t\troom.request = null;\n\t\t\troom.choices = null;\n\t\t\treturn;\n\t\t}\n\n\t\tBattleChoiceBuilder.fixRequest(request, room.battle);\n\n\t\tif (request.side) {\n\t\t\troom.battle.myPokemon = request.side.pokemon;\n\t\t\tif (room.battle.sidesSwitched !== !!(request.side.id === 'p2')) {\n\t\t\t\troom.battle.switchSides();\n\t\t\t}\n\t\t\troom.side = request.side;\n\t\t}\n\n\t\troom.request = request;\n\t\troom.choices = new BattleChoiceBuilder(request);\n\t\troom.update(null);\n\t}\n\trenderControls() {\n\t\tconst room = this.props.room;\n\t\tif (!room.battle) return null;\n\t\tif (room.side) {\n\t\t\treturn this.renderPlayerControls();\n\t\t}\n\t\tconst atEnd = room.battle.atQueueEnd;\n\t\treturn <div class=\"controls\">\n\t\t\t<p>\n\t\t\t\t{atEnd ?\n\t\t\t\t\t<button class=\"button disabled\" name=\"cmd\" value=\"/play\"><i class=\"fa fa-play\"></i><br />Play</button>\n\t\t\t\t: room.battle.paused ?\n\t\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/play\"><i class=\"fa fa-play\"></i><br />Play</button>\n\t\t\t\t:\n\t\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/pause\"><i class=\"fa fa-pause\"></i><br />Pause</button>\n\t\t\t\t} {}\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/ffto -1\"><i class=\"fa fa-step-backward\"></i><br />Last turn</button>\n\t\t\t\t<button class={\"button\" + (atEnd ? \" disabled\" : \"\")} name=\"cmd\" value=\"/ffto +1\"><i class=\"fa fa-step-forward\"></i><br />Skip turn</button> {}\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/ffto 0\"><i class=\"fa fa-undo\"></i><br />First turn</button>\n\t\t\t\t<button class={\"button\" + (atEnd ? \" disabled\" : \"\")} name=\"cmd\" value=\"/ffto end\"><i class=\"fa fa-fast-forward\"></i><br />Skip to end</button>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/switchsides\"><i class=\"fa fa-random\"></i> Switch sides</button>\n\t\t\t</p>\n\t\t</div>;\n\t}\n\trenderMoveControls(request: BattleMoveRequest, choices: BattleChoiceBuilder) {\n\t\tconst dex = this.props.room.battle.dex;\n\t\tconst pokemonIndex = choices.index();\n\t\tconst active = choices.currentMoveRequest();\n\t\tif (!active) return <div class=\"message-error\">Invalid pokemon</div>;\n\n\t\tif (choices.current.max || (active.maxMoves && !active.canDynamax)) {\n\t\t\tif (!active.maxMoves) {\n\t\t\t\treturn <div class=\"message-error\">Maxed with no max moves</div>;\n\t\t\t}\n\t\t\treturn active.moves.map((moveData, i) => {\n\t\t\t\tconst move = dex.getMove(moveData.name);\n\t\t\t\tconst maxMoveData = active.maxMoves![i];\n\t\t\t\tconst gmaxTooltip = maxMoveData.id.startsWith('gmax') ? `|${maxMoveData.id}` : ``;\n\t\t\t\tconst tooltip = `maxmove|${moveData.name}|${pokemonIndex}${gmaxTooltip}`;\n\t\t\t\treturn <MoveButton cmd={`/move ${i + 1} max`} type={move.type} tooltip={tooltip} moveData={moveData}>\n\t\t\t\t\t{maxMoveData.name}\n\t\t\t\t</MoveButton>;\n\t\t\t});\n\t\t}\n\n\t\tif (choices.current.z) {\n\t\t\tif (!active.zMoves) {\n\t\t\t\treturn <div class=\"message-error\">No Z moves</div>;\n\t\t\t}\n\t\t\treturn active.moves.map((moveData, i) => {\n\t\t\t\tconst move = dex.getMove(moveData.name);\n\t\t\t\tconst zMoveData = active.zMoves![i];\n\t\t\t\tif (!zMoveData) {\n\t\t\t\t\treturn <button disabled>&nbsp;</button>;\n\t\t\t\t}\n\t\t\t\tconst tooltip = `zmove|${moveData.name}|${pokemonIndex}`;\n\t\t\t\treturn <MoveButton cmd={`/move ${i + 1} zmove`} type={move.type} tooltip={tooltip} moveData={{pp: 1, maxpp: 1}}>\n\t\t\t\t\t{zMoveData.name}\n\t\t\t\t</MoveButton>;\n\t\t\t});\n\t\t}\n\n\t\treturn active.moves.map((moveData, i) => {\n\t\t\tconst move = dex.getMove(moveData.name);\n\t\t\tconst tooltip = `move|${moveData.name}|${pokemonIndex}`;\n\t\t\treturn <MoveButton cmd={`/move ${i + 1}`} type={move.type} tooltip={tooltip} moveData={moveData}>\n\t\t\t\t{move.name}\n\t\t\t</MoveButton>;\n\t\t});\n\t}\n\trenderMoveTargetControls(request: BattleMoveRequest, choices: BattleChoiceBuilder) {\n\t\tconst battle = this.props.room.battle;\n\t\tconst moveTarget = choices.getChosenMove(choices.current, choices.index()).target;\n\t\tconst moveChoice = choices.stringChoice(choices.current);\n\n\t\tconst userSlot = choices.index();\n\t\tconst userSlotCross = battle.farSide.active.length - 1 - userSlot;\n\n\t\treturn [\n\t\t\tbattle.farSide.active.map((pokemon, i) => {\n\t\t\t\tlet disabled = false;\n\t\t\t\tif (moveTarget === 'adjacentAlly' || moveTarget === 'adjacentAllyOrSelf') {\n\t\t\t\t\tdisabled = true;\n\t\t\t\t} else if (moveTarget === 'normal' || moveTarget === 'adjacentFoe') {\n\t\t\t\t\tif (Math.abs(userSlotCross - i) > 1) disabled = true;\n\t\t\t\t}\n\n\t\t\t\tif (pokemon?.fainted) pokemon = null;\n\t\t\t\treturn <PokemonButton\n\t\t\t\t\tpokemon={pokemon}\n\t\t\t\t\tcmd={disabled ? `` : `/${moveChoice} +${i + 1}`} disabled={disabled && 'fade'} tooltip={`activepokemon|1|${i}`}\n\t\t\t\t/>;\n\t\t\t}).reverse(),\n\t\t\t<div style=\"clear: left\"></div>,\n\t\t\tbattle.nearSide.active.map((pokemon, i) => {\n\t\t\t\tlet disabled = false;\n\t\t\t\tif (moveTarget === 'adjacentFoe') {\n\t\t\t\t\tdisabled = true;\n\t\t\t\t} else if (moveTarget === 'normal' || moveTarget === 'adjacentAlly' || moveTarget === 'adjacentAllyOrSelf') {\n\t\t\t\t\tif (Math.abs(userSlot - i) > 1) disabled = true;\n\t\t\t\t}\n\t\t\t\tif (moveTarget !== 'adjacentAllyOrSelf' && userSlot === i) disabled = true;\n\n\t\t\t\tif (pokemon?.fainted) pokemon = null;\n\t\t\t\treturn <PokemonButton\n\t\t\t\t\tpokemon={pokemon}\n\t\t\t\t\tcmd={disabled ? `` : `/${moveChoice} -${i + 1}`} disabled={disabled && 'fade'} tooltip={`activepokemon|0|${i}`}\n\t\t\t\t/>;\n\t\t\t}),\n\t\t];\n\t}\n\trenderSwitchControls(request: BattleMoveRequest | BattleSwitchRequest, choices: BattleChoiceBuilder) {\n\t\tconst numActive = choices.requestLength();\n\n\t\tconst trapped = choices.currentMoveRequest()?.trapped;\n\n\t\treturn request.side.pokemon.map((serverPokemon, i) => {\n\t\t\tconst cantSwitch = trapped || i < numActive || choices.alreadySwitchingIn.includes(i + 1) || serverPokemon.fainted;\n\t\t\treturn <PokemonButton\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${i + 1}`} disabled={cantSwitch} tooltip={`switchpokemon|${i}`}\n\t\t\t/>;\n\t\t});\n\t}\n\trenderTeamControls(request: | BattleTeamRequest, choices: BattleChoiceBuilder) {\n\t\treturn request.side.pokemon.map((serverPokemon, i) => {\n\t\t\tconst cantSwitch = choices.alreadySwitchingIn.includes(i + 1);\n\t\t\treturn <PokemonButton\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${i + 1}`} noHPBar disabled={cantSwitch && 'fade'} tooltip={`switchpokemon|${i}`}\n\t\t\t/>;\n\t\t});\n\t}\n\trenderTeamList() {\n\t\tconst team = this.props.room.battle.myPokemon;\n\t\tif (!team) return;\n\t\treturn <div class=\"switchcontrols\">\n\t\t\t<h3 class=\"switchselect\">Team</h3>\n\t\t\t<div class=\"switchmenu\">\n\t\t\t\t{team.map((serverPokemon, i) => {\n\t\t\t\t\treturn <PokemonButton\n\t\t\t\t\t\tpokemon={serverPokemon} cmd={``} noHPBar disabled={true} tooltip={`switchpokemon|${i}`}\n\t\t\t\t\t/>;\n\t\t\t\t})}\n\t\t\t</div>\n\t\t</div>;\n\t}\n\trenderChosenTeam(request: BattleTeamRequest, choices: BattleChoiceBuilder) {\n\t\treturn choices.alreadySwitchingIn.map(slot => {\n\t\t\tconst serverPokemon = request.side.pokemon[slot - 1];\n\t\t\treturn <PokemonButton\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${slot}`} disabled tooltip={`switchpokemon|${slot - 1}`}\n\t\t\t/>;\n\t\t});\n\t}\n\trenderOldChoices(request: BattleRequest, choices: BattleChoiceBuilder) {\n\t\tif (!choices) return null; // should not happen\n\t\tif (request.requestType !== 'move' && request.requestType !== 'switch') return;\n\t\tif (choices.isEmpty()) return null;\n\n\t\tlet buf: preact.ComponentChild[] = [\n\t\t\t<button name=\"cmd\" value=\"/cancel\" class=\"button\"><i class=\"fa fa-chevron-left\"></i> Back</button>, ' ',\n\t\t];\n\t\tif (choices.isDone() && request.noCancel) {\n\t\t\tbuf = ['Waiting for opponent...'];\n\t\t}\n\n\t\tconst battle = this.props.room.battle;\n\t\tfor (let i = 0; i < choices.choices.length; i++) {\n\t\t\tconst choiceString = choices.choices[i];\n\t\t\tconst choice = choices.parseChoice(choiceString);\n\t\t\tif (!choice) continue;\n\t\t\tconst pokemon = request.side.pokemon[i];\n\t\t\tconst active = request.requestType === 'move' ? request.active[i] : null;\n\t\t\tif (choice.choiceType === 'move') {\n\t\t\t\tbuf.push(`${pokemon.name} will `);\n\t\t\t\tif (choice.mega) buf.push(`Mega Evolve and `);\n\t\t\t\tif (choice.ultra) buf.push(`Ultra Burst and `);\n\t\t\t\tif (choice.max && active?.canDynamax) buf.push(active?.canGigantamax ? `Gigantamax and ` : `Dynamax and `);\n\t\t\t\tbuf.push(`use `, <strong>{choices.getChosenMove(choice, i).name}</strong>);\n\t\t\t\tif (choice.targetLoc > 0) {\n\t\t\t\t\tconst target = battle.farSide.active[choice.targetLoc - 1];\n\t\t\t\t\tif (!target) {\n\t\t\t\t\t\tbuf.push(` at slot ${choice.targetLoc}`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuf.push(` at ${target.name}`);\n\t\t\t\t\t}\n\t\t\t\t} else if (choice.targetLoc < 0) {\n\t\t\t\t\tconst target = battle.nearSide.active[-choice.targetLoc - 1];\n\t\t\t\t\tif (!target) {\n\t\t\t\t\t\tbuf.push(` at ally slot ${choice.targetLoc}`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuf.push(` at ally ${target.name}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (choice.choiceType === 'switch') {\n\t\t\t\tconst target = request.side.pokemon[choice.targetPokemon - 1];\n\t\t\t\tbuf.push(`${pokemon.name} will switch to `, <strong>{target.name}</strong>);\n\t\t\t} else if (choice.choiceType === 'shift') {\n\t\t\t\tbuf.push(`${pokemon.name} will `, <strong>shift</strong>, ` to the center`);\n\t\t\t}\n\t\t\tbuf.push(<br />);\n\t\t}\n\t\treturn buf;\n\t}\n\trenderPlayerControls() {\n\t\tconst room = this.props.room;\n\t\tconst request = room.request;\n\t\tlet choices = room.choices;\n\t\tif (!request) return 'Error: Missing request';\n\t\tif (!choices) return 'Error: Missing BattleChoiceBuilder';\n\t\tif (choices.request !== request) {\n\t\t\tchoices = new BattleChoiceBuilder(request);\n\t\t\troom.choices = choices;\n\t\t}\n\n\t\tif (choices.isDone()) {\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"pad\">\n\t\t\t\t\t{request.noCancel ? null : <button name=\"cmd\" value=\"/cancel\" class=\"button\">Cancel</button>}\n\t\t\t\t</div>\n\t\t\t\t{this.renderTeamList()}\n\t\t\t</div>;\n\t\t}\n\t\tif (request.side) room.battle.myPokemon = request.side.pokemon;\n\t\tswitch (request.requestType) {\n\t\tcase 'move': {\n\t\t\tconst index = choices.index();\n\t\t\tconst pokemon = request.side.pokemon[index];\n\t\t\tconst moveRequest = choices.currentMoveRequest()!;\n\n\t\t\tconst canDynamax = moveRequest.canDynamax && !choices.alreadyMax;\n\t\t\tconst canMegaEvo = moveRequest.canMegaEvo && !choices.alreadyMega;\n\t\t\tconst canZMove = moveRequest.zMoves && !choices.alreadyZ;\n\n\t\t\tif (choices.current.move) {\n\t\t\t\tconst moveName = choices.getChosenMove(choices.current, choices.index()).name;\n\t\t\t\treturn <div class=\"controls\">\n\t\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t\t\t{pokemon.name} should use <strong>{moveName}</strong> at where? {}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t\t{this.renderMoveTargetControls(request, choices)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>;\n\t\t\t}\n\n\t\t\tconst canShift = room.battle.gameType === 'triples' && index !== 1;\n\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t\tWhat will <strong>{pokemon.name}</strong> do?\n\t\t\t\t</div>\n\t\t\t\t<div class=\"movecontrols\">\n\t\t\t\t\t<h3 class=\"moveselect\">Attack</h3>\n\t\t\t\t\t<div class=\"movemenu\">\n\t\t\t\t\t\t{this.renderMoveControls(request, choices)}\n\t\t\t\t\t\t<div style=\"clear:left\"></div>\n\t\t\t\t\t\t{canDynamax && <label class={`megaevo${choices.current.max ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"max\" checked={choices.current.max} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\t{moveRequest.canGigantamax ? 'Gigantamax' : 'Dynamax'}\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t\t{canMegaEvo && <label class={`megaevo${choices.current.mega ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"mega\" checked={choices.current.mega} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\tMega Evolution\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t\t{moveRequest.canUltraBurst && <label class={`megaevo${choices.current.ultra ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"ultra\" checked={choices.current.ultra} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\tUltra Burst\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t\t{canZMove && <label class={`megaevo${choices.current.z ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"z\" checked={choices.current.z} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\tZ-Power\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t{canShift && [\n\t\t\t\t\t\t<h3 class=\"shiftselect\">Shift</h3>,\n\t\t\t\t\t\t<button name=\"cmd\" value=\"/shift\">Move to center</button>,\n\t\t\t\t\t]}\n\t\t\t\t\t<h3 class=\"switchselect\">Switch</h3>\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderSwitchControls(request, choices)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t} case 'switch': {\n\t\t\tconst pokemon = request.side.pokemon[choices.index()];\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t\tWhat will <strong>{pokemon.name}</strong> do?\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t<h3 class=\"switchselect\">Switch</h3>\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderSwitchControls(request, choices)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t} case 'team': {\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{choices.alreadySwitchingIn.length > 0 ?\n\t\t\t\t\t\t[<button name=\"cmd\" value=\"/cancel\" class=\"button\"><i class=\"fa fa-chevron-left\"></i> Back</button>,\n\t\t\t\t\t\t\" What about the rest of your team? \"]\n\t\t\t\t\t:\n\t\t\t\t\t\t\"How will you start the battle? \"\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t<h3 class=\"switchselect\">Choose {choices.alreadySwitchingIn.length <= 0 ? `lead` : `slot ${choices.alreadySwitchingIn.length + 1}`}</h3>\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderTeamControls(request, choices)}\n\t\t\t\t\t\t<div style=\"clear:left\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t{choices.alreadySwitchingIn.length > 0 && <h3 class=\"switchselect\">Team so far</h3>}\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderChosenTeam(request, choices)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t}}\n\t}\n\trender() {\n\t\tconst room = this.props.room;\n\n\t\treturn <PSPanelWrapper room={room}>\n\t\t\t<BattleDiv></BattleDiv>\n\t\t\t<ChatLog class=\"battle-log hasuserlist\" room={this.props.room} onClick={this.focusIfNoSelection} left={640} noSubscription>\n\t\t\t\t{}\n\t\t\t</ChatLog>\n\t\t\t<ChatTextEntry room={this.props.room} onMessage={this.send} onKey={this.onKey} left={640} />\n\t\t\t<ChatUserList room={this.props.room} left={640} minimized />\n\t\t\t<div class=\"battle-controls\" role=\"complementary\" aria-label=\"Battle Controls\" style=\"top: 370px;\">\n\t\t\t\t{this.renderControls()}\n\t\t\t</div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nPS.roomTypes['battle'] = {\n\tModel: BattleRoom,\n\tComponent: BattlePanel,\n};\nPS.roomTypes['battles'] = {\n\tModel: BattlesRoom,\n\tComponent: BattlesPanel,\n};\nPS.updateRoomTypes();\n"],"file":"panel-battle.js"}