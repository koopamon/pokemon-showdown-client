{"version":3,"sources":["../src/panel-mainmenu.tsx"],"names":["MainMenuRoom","classType","userdetailsCache","roomsCache","receiveLine","args","cmd","challstr","PSLoginServer","query","act","then","res","loggedin","send","username","assertion","fullName","namedCode","avatar","PS","user","setName","challengesBuf","receiveChallenges","queryId","responseJSON","handleQueryResponse","JSON","parse","user1","user2","message","handlePM","parseFormats","alert","replace","lobby","rooms","dataBuf","json","userid","challengesFrom","getPMRoom","toID","challengeTo","to","roomid","room","pmTarget","targetUserid","challengedFormat","challengingFormat","format","update","formatsList","isSection","section","column","window","BattleFormats","j","length","entry","teams","usesLocalLadder","charAt","isNaN","Number","slice","parseInt","name","searchShow","challengeShow","tournamentShow","team","teambuilderLevel","lastCommaIndex","lastIndexOf","code","substr","NaN","id","isTeambuilderFormat","teambuilderFormat","teambuilderFormatName","parenPos","indexOf","trim","rated","effectType","multivariantFormats","battleFormat","userid1","userid2","sort","join","addRoom","response","userdetails","Object","assign","userRoom","roomsRoom","battlesRoom","battleTable","battles","battleid","push","PSRoom","NewsPanel","render","props","__html","newsHTML","PSRoomPanel","MainMenuPanel","submit","e","focus","base","querySelector","renderMiniRoom","roomType","roomTypes","type","Panel","Component","renderMiniRooms","miniRoomList","map","title","onlineButton","isOffline","searchButton","down","textAlign","Config","routes","client","display","leftRoomWidth","server","dex","replays","root","FormatDropdown","change","forceUpdate","onChange","getFormat","value","componentDidMount","preact","TeamDropdown","getTeam","key","byKey","formatid","list","formatData","teambox","TeamForm","state","changeFormat","setState","target","preventDefault","teamKey","undefined","onSubmit","children","Model"],"mappings":"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","sourcesContent":["/**\n * Main menu panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\ntype RoomInfo = {title: string, desc?: string, userCount?: number, subRooms?: string[]};\n\nclass MainMenuRoom extends PSRoom {\n\treadonly classType: string = 'mainmenu';\n\tuserdetailsCache: {[userid: string]: {\n\t\tuserid: ID,\n\t\tavatar?: string | number,\n\t\tstatus?: string,\n\t\tgroup?: string,\n\t\trooms?: {[roomid: string]: {isPrivate?: true, p1?: string, p2?: string}},\n\t}} = {};\n\troomsCache: {\n\t\tbattleCount?: number,\n\t\tuserCount?: number,\n\t\tchat?: RoomInfo[],\n\t\tofficial?: RoomInfo[],\n\t\tpspl?: RoomInfo[],\n\t} = {};\n\treceiveLine(args: Args) {\n\t\tconst [cmd] = args;\n\t\tswitch (cmd) {\n\t\tcase 'challstr': {\n\t\t\tconst [, challstr] = args;\n\t\t\tPSLoginServer.query({\n\t\t\t\tact: 'upkeep',\n\t\t\t\tchallstr,\n\t\t\t}).then(res => {\n\t\t\t\tif (!res) return;\n\t\t\t\tif (!res.loggedin) return;\n\t\t\t\tthis.send(`/trn ${res.username},0,${res.assertion}`);\n\t\t\t});\n\t\t\treturn;\n\t\t} case 'updateuser': {\n\t\t\tconst [, fullName, namedCode, avatar] = args;\n\t\t\tPS.user.setName(fullName, namedCode === '1', avatar);\n\t\t\treturn;\n\t\t} case 'updatechallenges': {\n\t\t\tconst [, challengesBuf] = args;\n\t\t\tthis.receiveChallenges(challengesBuf);\n\t\t\treturn;\n\t\t} case 'queryresponse': {\n\t\t\tconst [, queryId, responseJSON] = args;\n\t\t\tthis.handleQueryResponse(queryId as ID, JSON.parse(responseJSON));\n\t\t\treturn;\n\t\t} case 'pm': {\n\t\t\tconst [, user1, user2, message] = args;\n\t\t\tthis.handlePM(user1, user2, message);\n\t\t\treturn;\n\t\t} case 'formats': {\n\t\t\tthis.parseFormats(args);\n\t\t\treturn;\n\t\t} case 'popup': {\n\t\t\tconst [, message] = args;\n\t\t\talert(message.replace(/\\|\\|/g, '\\n'));\n\t\t\treturn;\n\t\t}}\n\t\tconst lobby = PS.rooms['lobby'];\n\t\tif (lobby) lobby.receiveLine(args);\n\t}\n\treceiveChallenges(dataBuf: string) {\n\t\tlet json;\n\t\ttry {\n\t\t\tjson = JSON.parse(dataBuf);\n\t\t} catch {}\n\t\tfor (const userid in json.challengesFrom) {\n\t\t\tPS.getPMRoom(toID(userid));\n\t\t}\n\t\tif (json.challengeTo) {\n\t\t\tPS.getPMRoom(toID(json.challengeTo.to));\n\t\t}\n\t\tfor (const roomid in PS.rooms) {\n\t\t\tconst room = PS.rooms[roomid] as ChatRoom;\n\t\t\tif (!room.pmTarget) continue;\n\t\t\tconst targetUserid = toID(room.pmTarget);\n\t\t\tif (!room.challengedFormat && !(targetUserid in json.challengesFrom) &&\n\t\t\t\t!room.challengingFormat && json.challengeTo?.to !== targetUserid) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\troom.challengedFormat = json.challengesFrom[targetUserid] || null;\n\t\t\troom.challengingFormat = json.challengeTo?.to === targetUserid ? json.challengeTo.format : null;\n\t\t\troom.update(null);\n\t\t}\n\t}\n\tparseFormats(formatsList: string[]) {\n\t\tlet isSection = false;\n\t\tlet section = '';\n\n\t\tlet column = 0;\n\n\t\twindow.BattleFormats = {};\n\t\tfor (let j = 1; j < formatsList.length; j++) {\n\t\t\tconst entry = formatsList[j];\n\t\t\tif (isSection) {\n\t\t\t\tsection = entry;\n\t\t\t\tisSection = false;\n\t\t\t} else if (entry === ',LL') {\n\t\t\t\tPS.teams.usesLocalLadder = true;\n\t\t\t} else if (entry === '' || (entry.charAt(0) === ',' && !isNaN(Number(entry.slice(1))))) {\n\t\t\t\tisSection = true;\n\n\t\t\t\tif (entry) {\n\t\t\t\t\tcolumn = parseInt(entry.slice(1), 10) || 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet name = entry;\n\t\t\t\tlet searchShow = true;\n\t\t\t\tlet challengeShow = true;\n\t\t\t\tlet tournamentShow = true;\n\t\t\t\tlet team: 'preset' | null = null;\n\t\t\t\tlet teambuilderLevel: number | null = null;\n\t\t\t\tlet lastCommaIndex = name.lastIndexOf(',');\n\t\t\t\tlet code = lastCommaIndex >= 0 ? parseInt(name.substr(lastCommaIndex + 1), 16) : NaN;\n\t\t\t\tif (!isNaN(code)) {\n\t\t\t\t\tname = name.substr(0, lastCommaIndex);\n\t\t\t\t\tif (code & 1) team = 'preset';\n\t\t\t\t\tif (!(code & 2)) searchShow = false;\n\t\t\t\t\tif (!(code & 4)) challengeShow = false;\n\t\t\t\t\tif (!(code & 8)) tournamentShow = false;\n\t\t\t\t\tif (code & 16) teambuilderLevel = 50;\n\t\t\t\t} else {\n\t\t\t\t\t// Backwards compatibility: late 0.9.0 -> 0.10.0\n\t\t\t\t\tif (name.substr(name.length - 2) === ',#') { // preset teams\n\t\t\t\t\t\tteam = 'preset';\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\n\t\t\t\t\t}\n\t\t\t\t\tif (name.substr(name.length - 2) === ',,') { // search-only\n\t\t\t\t\t\tchallengeShow = false;\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\n\t\t\t\t\t} else if (name.substr(name.length - 1) === ',') { // challenge-only\n\t\t\t\t\t\tsearchShow = false;\n\t\t\t\t\t\tname = name.substr(0, name.length - 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet id = toID(name);\n\t\t\t\tlet isTeambuilderFormat = !team && name.slice(-11) !== 'Custom Game';\n\t\t\t\tlet teambuilderFormat = '' as ID;\n\t\t\t\tlet teambuilderFormatName = '';\n\t\t\t\tif (isTeambuilderFormat) {\n\t\t\t\t\tteambuilderFormatName = name;\n\t\t\t\t\tif (id.slice(0, 3) !== 'gen') {\n\t\t\t\t\t\tteambuilderFormatName = '[Gen 6] ' + name;\n\t\t\t\t\t}\n\t\t\t\t\tlet parenPos = teambuilderFormatName.indexOf('(');\n\t\t\t\t\tif (parenPos > 0 && name.slice(-1) === ')') {\n\t\t\t\t\t\t// variation of existing tier\n\t\t\t\t\t\tteambuilderFormatName = teambuilderFormatName.slice(0, parenPos).trim();\n\t\t\t\t\t}\n\t\t\t\t\tif (teambuilderFormatName !== name) {\n\t\t\t\t\t\tteambuilderFormat = toID(teambuilderFormatName);\n\t\t\t\t\t\tif (BattleFormats[teambuilderFormat]) {\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat].isTeambuilderFormat = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat] = {\n\t\t\t\t\t\t\t\tid: teambuilderFormat,\n\t\t\t\t\t\t\t\tname: teambuilderFormatName,\n\t\t\t\t\t\t\t\tteam,\n\t\t\t\t\t\t\t\tsection,\n\t\t\t\t\t\t\t\tcolumn,\n\t\t\t\t\t\t\t\trated: false,\n\t\t\t\t\t\t\t\tisTeambuilderFormat: true,\n\t\t\t\t\t\t\t\teffectType: 'Format',\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tisTeambuilderFormat = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (BattleFormats[id]?.isTeambuilderFormat) {\n\t\t\t\t\tisTeambuilderFormat = true;\n\t\t\t\t}\n\t\t\t\t// make sure formats aren't out-of-order\n\t\t\t\tif (BattleFormats[id]) delete BattleFormats[id];\n\t\t\t\tBattleFormats[id] = {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tteam,\n\t\t\t\t\tsection,\n\t\t\t\t\tcolumn,\n\t\t\t\t\tsearchShow,\n\t\t\t\t\tchallengeShow,\n\t\t\t\t\ttournamentShow,\n\t\t\t\t\trated: searchShow && id.substr(4, 7) !== 'unrated',\n\t\t\t\t\tteambuilderLevel,\n\t\t\t\t\tteambuilderFormat,\n\t\t\t\t\tisTeambuilderFormat,\n\t\t\t\t\teffectType: 'Format',\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Match base formats to their variants, if they are unavailable in the server.\n\t\tlet multivariantFormats: {[id: string]: 1} = {};\n\t\tfor (let id in BattleFormats) {\n\t\t\tlet teambuilderFormat = BattleFormats[BattleFormats[id].teambuilderFormat!];\n\t\t\tif (!teambuilderFormat || multivariantFormats[teambuilderFormat.id]) continue;\n\t\t\tif (!teambuilderFormat.searchShow && !teambuilderFormat.challengeShow && !teambuilderFormat.tournamentShow) {\n\t\t\t\t// The base format is not available.\n\t\t\t\tif (teambuilderFormat.battleFormat) {\n\t\t\t\t\tmultivariantFormats[teambuilderFormat.id] = 1;\n\t\t\t\t\tteambuilderFormat.battleFormat = '';\n\t\t\t\t} else {\n\t\t\t\t\tteambuilderFormat.battleFormat = id;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tPS.teams.update('format');\n\t}\n\thandlePM(user1: string, user2: string, message: string) {\n\t\tconst userid1 = toID(user1);\n\t\tconst userid2 = toID(user2);\n\t\tconst roomid = `pm-${[userid1, userid2].sort().join('-')}` as RoomID;\n\t\tlet room = PS.rooms[roomid];\n\t\tif (!room) {\n\t\t\tconst pmTarget = PS.user.userid === userid1 ? user2 : user1;\n\t\t\tPS.addRoom({\n\t\t\t\tid: roomid,\n\t\t\t\tpmTarget,\n\t\t\t}, true);\n\t\t\troom = PS.rooms[roomid]!;\n\t\t}\n\t\troom.receiveLine([`c`, user1, message]);\n\t\tPS.update();\n\t}\n\thandleQueryResponse(id: ID, response: any) {\n\t\tswitch (id) {\n\t\tcase 'userdetails':\n\t\t\tlet userid = response.userid;\n\t\t\tlet userdetails = this.userdetailsCache[userid];\n\t\t\tif (!userdetails) {\n\t\t\t\tthis.userdetailsCache[userid] = response;\n\t\t\t} else {\n\t\t\t\tObject.assign(userdetails, response);\n\t\t\t}\n\t\t\tconst userRoom = PS.rooms[`user-${userid}`] as UserRoom;\n\t\t\tif (userRoom) userRoom.update(null);\n\t\t\tbreak;\n\t\tcase 'rooms':\n\t\t\tthis.roomsCache = response;\n\t\t\tconst roomsRoom = PS.rooms[`rooms`] as RoomsRoom;\n\t\t\tif (roomsRoom) roomsRoom.update(null);\n\t\t\tbreak;\n\t\tcase 'roomlist':\n\t\t\tconst battlesRoom = PS.rooms[`battles`] as BattlesRoom;\n\t\t\tif (battlesRoom) {\n\t\t\t\tconst battleTable = response.rooms;\n\t\t\t\tconst battles = [];\n\t\t\t\tfor (const battleid in battleTable) {\n\t\t\t\t\tbattleTable[battleid].id = battleid;\n\t\t\t\t\tbattles.push(battleTable[battleid]);\n\t\t\t\t}\n\t\t\t\tbattlesRoom.battles = battles;\n\t\t\t\tbattlesRoom.update(null);\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass NewsPanel extends PSRoomPanel {\n\trender() {\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\n\t\t\t<div class=\"mini-window-body\" dangerouslySetInnerHTML={{__html: PS.newsHTML}}></div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nclass MainMenuPanel extends PSRoomPanel<MainMenuRoom> {\n\tfocus() {\n\t\t(this.base!.querySelector('button.big') as HTMLButtonElement).focus();\n\t}\n\tsubmit = (e: Event) => {\n\t\talert('todo: implement');\n\t};\n\trenderMiniRoom(room: PSRoom) {\n\t\tconst roomType = PS.roomTypes[room.type];\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\n\t\treturn <Panel key={room.id} room={room} />;\n\t}\n\trenderMiniRooms() {\n\t\treturn PS.miniRoomList.map(roomid => {\n\t\t\tconst room = PS.rooms[roomid]!;\n\t\t\treturn <div class=\"pmbox\">\n\t\t\t\t<div class=\"mini-window\">\n\t\t\t\t\t<h3>\n\t\t\t\t\t\t<button class=\"closebutton\" name=\"closeRoom\" value={roomid} aria-label=\"Close\" tabIndex={-1}><i class=\"fa fa-times-circle\"></i></button>\n\t\t\t\t\t\t<button class=\"minimizebutton\" tabIndex={-1}><i class=\"fa fa-minus-circle\"></i></button>\n\t\t\t\t\t\t{room.title}\n\t\t\t\t\t</h3>\n\t\t\t\t\t{this.renderMiniRoom(room)}\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t});\n\t}\n\trender() {\n\t\tconst onlineButton = ' button' + (PS.isOffline ? ' disabled' : '');\n\t\tconst searchButton = (PS.down ? <div class=\"menugroup\" style=\"background: rgba(10,10,10,.6)\">\n\t\t\t{PS.down === 'ddos' ?\n\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to a DDoS attack!</strong></p>\n\t\t\t:\n\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to technical difficulties!</strong></p>\n\t\t\t}\n\t\t\t<p>\n\t\t\t\t<div style={{textAlign: 'center'}}>\n\t\t\t\t\t<img width=\"96\" height=\"96\" src={`//${Config.routes.client}/sprites/gen5/teddiursa.png`} alt=\"\" />\n\t\t\t\t</div>\n\t\t\t\tBear with us as we freak out.\n\t\t\t</p>\n\t\t\t<p>(We'll be back up in a few hours.)</p>\n\t\t</div> : <TeamForm class=\"menugroup\" onSubmit={this.submit}>\n\t\t\t<button class={\"mainmenu1 big\" + onlineButton} name=\"search\">\n\t\t\t\t<strong>Battle!</strong><br />\n\t\t\t\t<small>Find a random opponent</small>\n\t\t\t</button>\n\t\t</TeamForm>);\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\n\t\t\t<div class=\"mainmenuwrapper\">\n\t\t\t\t<div class=\"leftmenu\">\n\t\t\t\t\t<div class=\"activitymenu\">\n\t\t\t\t\t\t{this.renderMiniRooms()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"mainmenu\">\n\t\t\t\t\t\t{searchButton}\n\n\t\t\t\t\t\t<div class=\"menugroup\">\n\t\t\t\t\t\t\t<p><button class=\"mainmenu2 button\" name=\"joinRoom\" value=\"teambuilder\">Teambuilder</button></p>\n\t\t\t\t\t\t\t<p><button class={\"mainmenu3\" + onlineButton} name=\"joinRoom\" value=\"ladder\">Ladder</button></p>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"menugroup\">\n\t\t\t\t\t\t\t<p><button class={\"mainmenu4\" + onlineButton} name=\"joinRoom\" value=\"battles\">Watch a battle</button></p>\n\t\t\t\t\t\t\t<p><button class={\"mainmenu5\" + onlineButton} name=\"finduser\">Find a user</button></p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"rightmenu\" style={{display: PS.leftRoomWidth ? 'none' : 'block'}}>\n\t\t\t\t\t<div class=\"menugroup\">\n\t\t\t\t\t\t{PS.server.id === 'showdown' ?\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"rooms\">Join chat</button></p>\n\t\t\t\t\t\t:\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"lobby\">Join lobby chat</button></p>\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mainmenufooter\">\n\t\t\t\t\t<div class=\"bgcredit\"></div>\n\t\t\t\t\t<small>\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/`} target=\"_blank\">Pok&eacute;dex</a> | {}\n\t\t\t\t\t\t<a href={`//${Config.routes.replays}/`} target=\"_blank\">Replays</a> | {}\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/rules`} target=\"_blank\">Rules</a> | {}\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/credits`} target=\"_blank\">Credits</a> | {}\n\t\t\t\t\t\t<a href=\"//smogon.com/forums/\" target=\"_blank\">Forum</a>\n\t\t\t\t\t</small>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nclass FormatDropdown extends preact.Component<{format?: string, onChange?: JSX.EventHandler<Event>}> {\n\tbase?: HTMLButtonElement;\n\tgetFormat() {\n\t\treturn this.base?.value || '[Gen 7] Random Battle';\n\t}\n\tcomponentDidMount() {\n\t\tthis.base!.value = this.getFormat();\n\t}\n\tchange = (e: Event) => {\n\t\tthis.forceUpdate();\n\t\tif (this.props.onChange) this.props.onChange(e);\n\t};\n\trender() {\n\t\tif (this.props.format) {\n\t\t\treturn <button\n\t\t\t\tclass=\"select formatselect preselected\" name=\"format\" value={this.props.format} disabled\n\t\t\t>{this.props.format}</button>;\n\t\t}\n\t\tconst format = this.getFormat();\n\t\treturn <button class=\"select formatselect\" name=\"format\" data-href=\"/formatdropdown\" onChange={this.change}>\n\t\t\t{format}\n\t\t</button>;\n\t}\n}\n\nclass TeamDropdown extends preact.Component<{format: string}> {\n\tbase?: HTMLButtonElement;\n\tgetTeam() {\n\t\tif (this.base) {\n\t\t\tconst key = this.base.value;\n\t\t\treturn PS.teams.byKey[key] || null;\n\t\t}\n\t\tconst formatid = PS.teams.teambuilderFormat(this.props.format);\n\t\tfor (const team of PS.teams.list) {\n\t\t\tif (team.format === formatid) return team;\n\t\t}\n\t\treturn null;\n\t}\n\tcomponentDidMount() {\n\t\tconst team = this.getTeam();\n\t\tif (team) {\n\t\t\tthis.base!.value = team.key;\n\t\t}\n\t}\n\tchange = () => this.forceUpdate();\n\trender() {\n\t\tconst formatid = PS.teams.teambuilderFormat(this.props.format);\n\t\tconst formatData = window.BattleFormats?.[formatid];\n\t\tif (formatData && formatData.team) {\n\t\t\treturn <button class=\"select teamselect preselected\" name=\"team\" value=\"random\" disabled>\n\t\t\t\t<div class=\"team\">\n\t\t\t\t\t<strong>Random team</strong>\n\t\t\t\t\t<small>\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={`float:left;background:transparent url(https://${Config.routes.client}/sprites/pokemonicons-sheet.png?a6) no-repeat scroll -0px -0px`}></span>\n\t\t\t\t\t</small>\n\t\t\t\t</div>\n\t\t\t</button>;\n\t\t}\n\t\tconst team = this.getTeam();\n\t\tlet teambox = null;\n\t\tif (PS.roomTypes['teamdropdown']) {\n\t\t\tteambox = <TeamBox team={team} noLink />;\n\t\t}\n\t\treturn <button class=\"select teamselect\" name=\"team\" data-href=\"/teamdropdown\" data-format={formatid} onChange={this.change}>\n\t\t\t{teambox}\n\t\t</button>;\n\t}\n}\n\nclass TeamForm extends preact.Component<{\n\tchildren: preact.ComponentChildren, class?: string, format?: string,\n\tonSubmit: null | ((e: Event, format: string, team?: Team) => void),\n}> {\n\tstate = {format: '[Gen 7] Random Battle'};\n\tchangeFormat = (e: Event) => {\n\t\tthis.setState({format: (e.target as HTMLButtonElement).value});\n\t};\n\tsubmit = (e: Event) => {\n\t\te.preventDefault();\n\t\tconst format = (this.base!.querySelector('button[name=format]') as HTMLButtonElement).value;\n\t\tconst teamKey = (this.base!.querySelector('button[name=team]') as HTMLButtonElement).value;\n\t\tconst team = teamKey ? PS.teams.byKey[teamKey] : undefined;\n\t\tif (this.props.onSubmit) this.props.onSubmit(e, format, team);\n\t};\n\trender() {\n\t\treturn <form class={this.props.class} onSubmit={this.submit}>\n\t\t\t<p>\n\t\t\t\t<label class=\"label\">\n\t\t\t\t\tFormat:<br />\n\t\t\t\t\t<FormatDropdown onChange={this.changeFormat} format={this.props.format} />\n\t\t\t\t</label>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t<label class=\"label\">\n\t\t\t\t\tTeam:<br />\n\t\t\t\t\t<TeamDropdown format={this.state.format} />\n\t\t\t\t</label>\n\t\t\t</p>\n\t\t\t<p>{this.props.children}</p>\n\t\t</form>;\n\t}\n}\n\nPS.roomTypes['news'] = {\n\tComponent: NewsPanel,\n};\n\nPS.roomTypes['mainmenu'] = {\n\tModel: MainMenuRoom,\n\tComponent: MainMenuPanel,\n};\n"],"file":"panel-mainmenu.js"}